<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Estimate Targeting Weights Using Optimization — optweight.svy • optweight</title><!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png"><link rel="icon" type="”image/svg+xml”" href="../favicon.svg"><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" sizes="any" href="../favicon.ico"><link rel="manifest" href="../site.webmanifest"><!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Estimate Targeting Weights Using Optimization — optweight.svy"><meta name="description" content="Estimate targeting weights for covariates specified in formula. The
target means are specified with targets and the maximum distance
between each weighted covariate mean and the corresponding target mean is
specified by tols. See Zubizarreta (2015) for details of the
properties of the weights and the methods used to fit them."><meta property="og:description" content="Estimate targeting weights for covariates specified in formula. The
target means are specified with targets and the maximum distance
between each weighted covariate mean and the corresponding target mean is
specified by tols. See Zubizarreta (2015) for details of the
properties of the weights and the methods used to fit them."><meta property="og:image" content="https://ngreifer.github.io/optweight/logo.png"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">optweight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="../articles/optweight.html">Get started</a></li>
<li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/optweight/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Estimate Targeting Weights Using Optimization</h1>
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/optweight/blob/master/R/optweight.svy.R" class="external-link"><code>R/optweight.svy.R</code></a></small>
      <div class="d-none name"><code>optweight.svy.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Estimate targeting weights for covariates specified in <code>formula</code>. The
target means are specified with <code>targets</code> and the maximum distance
between each weighted covariate mean and the corresponding target mean is
specified by <code>tols</code>. See Zubizarreta (2015) for details of the
properties of the weights and the methods used to fit them.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">optweight.svy</span><span class="op">(</span></span>
<span>  <span class="va">formula</span>,</span>
<span>  data <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tols <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  targets <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  s.weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  b.weights <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  norm <span class="op">=</span> <span class="st">"l2"</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-formula">formula<a class="anchor" aria-label="anchor" href="#arg-formula"></a></dt>
<dd><p>a formula with nothing on the left hand side and the
covariates to be targeted on the right hand side. See <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code> for
more details. Interactions and functions of covariates are allowed.</p></dd>


<dt id="arg-data">data<a class="anchor" aria-label="anchor" href="#arg-data"></a></dt>
<dd><p>An optional data set in the form of a data frame that contains the variables in <code>formula</code>.</p></dd>


<dt id="arg-tols">tols<a class="anchor" aria-label="anchor" href="#arg-tols"></a></dt>
<dd><p>a vector of target balance tolerance values for each covariate.
The resulting weighted covariate means will be no further away from the
targets than the specified values. If only one value is supplied, it will be
applied to all covariates. Can also be the output of a call to <code><a href="process_tols.html">process_tols()</a></code>.</p></dd>


<dt id="arg-targets">targets<a class="anchor" aria-label="anchor" href="#arg-targets"></a></dt>
<dd><p>A vector of target population mean values for each baseline covariate. The resulting weights will yield sample means within <code>tols</code>/2 units of the target values for each covariate. If <code>NULL</code> or all <code>NA</code>, <code>estimand</code> will be used to determine targets. Otherwise, <code>estimand</code> is ignored. If any target values are <code>NA</code>, the corresponding variable will not be targeted and its weighted mean will be wherever the weights yield the smallest variance. Can also be the output of a call to <code><a href="process_targets.html">process_targets()</a></code>. See Details.</p></dd>


<dt id="arg-s-weights">s.weights<a class="anchor" aria-label="anchor" href="#arg-s-weights"></a></dt>
<dd><p>A vector of sampling weights or the name of a variable in <code>data</code> that contains sampling weights.</p></dd>


<dt id="arg-b-weights">b.weights<a class="anchor" aria-label="anchor" href="#arg-b-weights"></a></dt>
<dd><p>A vector of base weights or the name of a variable in <code>data</code> that contains base weights. If supplied, the desired norm of the distance between the estimated weights and the base weights is minimized.</p></dd>


<dt id="arg-norm">norm<a class="anchor" aria-label="anchor" href="#arg-norm"></a></dt>
<dd><p><code>character</code>; a string containing the name of the norm corresponding to the objective function to minimize. Allowable options include <code>"l1"</code> for the L1 norm, <code>"l2"</code> for the L2 norm (the default), <code>"linf"</code> for the L\(\infty\) norm, <code>"entropy"</code> for the negative entropy, and <code>"log"</code> for the sum of the logs. See <code><a href="optweight.fit.html">optweight.fit()</a></code> for details.</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p><code>logical</code>; whether information on the optimization problem solution should be printed. Default is <code>FALSE</code>.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="optweight.svy.fit.html">optweight.svy.fit</a></code></p><dl><dt><code>std.binary,std.cont</code></dt>
<dd><p><code>logical</code>; whether the tolerances are in standardized mean units (<code>TRUE</code>) or raw units (<code>FALSE</code>) for binary variables and continuous variables, respectively. The default is <code>FALSE</code> for <code>std.binary</code> because raw proportion differences make more sense than standardized mean difference for binary variables. These arguments are analogous to the <code>binary</code> and <code>continuous</code> arguments in <code><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab()</a></code> in <span class="pkg">cobalt</span>.</p></dd>

    <dt><code>min.w</code></dt>
<dd><p><code>numeric</code>; a single value less than 1 for the smallest allowable weight. Some analyses require nonzero weights for all units, so a small, nonzero minimum may be desirable. The default is <code>1e-8</code> (\(10^{-8}\)), which does not materially change the properties of the weights from a minimum of 0 but prevents warnings in some packages that use weights to estimate treatment effects. When <code>norm</code> is <code>"entropy"</code> or <code>"log"</code> and <code>min.w &lt;= 0</code>, <code>min.w</code> will be set to the smallest nonzero value.</p></dd>


</dl></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>An <code>optweight.svy</code> object with the following elements:</p>
<dl><dt>weights</dt>
<dd><p>The estimated weights, one for each unit.</p></dd>

<dt>covs</dt>
<dd><p>The covariates used in the fitting. Only includes the raw covariates, which may have been altered in the fitting process.</p></dd>

<dt>s.weights</dt>
<dd><p>The provided sampling weights.</p></dd>

<dt>call</dt>
<dd><p>The function call.</p></dd>

<dt>tols</dt>
<dd><p>The tolerance values for each covariate.</p></dd>

<dt>duals</dt>
<dd><p>A data.frame containing the dual variables for each covariate. See <code><a href="optweight.html">optweight()</a></code> for interpretation of these values.</p></dd>

<dt>info</dt>
<dd><p>Information about the performance of the optimization at termination.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The optimization is performed by the lower-level function
<code><a href="optweight.svy.fit.html">optweight.svy.fit()</a></code>.</p>
<p>Weights are estimated so that the standardized differences between the
weighted covariate means and the corresponding targets are within the given
tolerance thresholds (unless <code>std.binary</code> or <code>std.cont</code> are
<code>FALSE</code>, in which case unstandardized mean differences are considered
for binary and continuous variables, respectively). For a covariate \(x\)
with specified tolerance \(\delta\), the weighted mean will be within
\(\delta\) of the target. If standardized tolerance values are requested,
the standardization factor is the standard deviation of the covariate in the
whole sample. The standardization factor is always unweighted.</p>
<p>See the <code><a href="optweight.html">optweight()</a></code> help page for information on interpreting
dual variables and solving convergence failure.</p>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>Zubizarreta, J. R. (2015). Stable Weights that Balance Covariates for Estimation With Incomplete Outcome Data. <em>Journal of the American Statistical Association</em>, 110(511), 910–922. <a href="https://doi.org/10.1080/01621459.2015.1023805" class="external-link">doi:10.1080/01621459.2015.1023805</a></p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="optweight.svy.fit.html">optweight.svy.fit()</a></code>, the lower-level function that performs the fitting.</p>
<p><code><a href="optweight.fit.html">optweight.fit()</a></code> for more details about the optimization options.</p>
<p><code><a href="optweight.html">optweight()</a></code> for estimating weights that balance treatment groups.</p></div>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://ngreifer.github.io/cobalt/" class="external-link">"cobalt"</a></span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">cov.formula</span> <span class="op">&lt;-</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span> <span class="va">nodegree</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="process_targets.html">process_targets</a></span><span class="op">(</span><span class="va">cov.formula</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                           targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">23</span>, <span class="fl">9</span>, <span class="fl">.3</span>, <span class="fl">.3</span>, <span class="fl">.4</span>,</span></span>
<span class="r-in"><span>                                       <span class="fl">.2</span>, <span class="fl">.5</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="va">ows</span> <span class="op">&lt;-</span> <span class="fu">optweight.svy</span><span class="op">(</span><span class="va">cov.formula</span>,</span></span>
<span class="r-in"><span>                     data <span class="op">=</span> <span class="va">lalonde</span>,</span></span>
<span class="r-in"><span>                     tols <span class="op">=</span> <span class="fl">0</span>,</span></span>
<span class="r-in"><span>                     targets <span class="op">=</span> <span class="va">targets</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">ows</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> An optweight.svy object</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - number of obs.: 614</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - norm minimized: "l2"</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - sampling weights: present</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - base weights: present</span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  - covariates: age, educ, race, married, nodegree</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Unweighted means</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">col_w_mean</a></span><span class="op">(</span><span class="va">ows</span><span class="op">$</span><span class="va">covs</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         age        educ  race_black race_hispan  race_white     married </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>  27.3631922  10.2687296   0.3957655   0.1172638   0.4869707   0.4153094 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    nodegree </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   0.6302932 </span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">#Weighted means; same as targets</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">col_w_mean</a></span><span class="op">(</span><span class="va">ows</span><span class="op">$</span><span class="va">covs</span>, w <span class="op">=</span> <span class="va">ows</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         age        educ  race_black race_hispan  race_white     married </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>        23.0         9.0         0.3         0.3         0.4         0.2 </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    nodegree </span>
<span class="r-out co"><span class="r-pr">#&gt;</span>         0.5 </span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

    </footer></div>





  </body></html>

