<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Using optweight to Estimate Stable Balancing Weights • optweight</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="96x96" href="../favicon-96x96.png">
<link rel="icon" type="”image/svg+xml”" href="../favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png">
<link rel="icon" sizes="any" href="../favicon.ico">
<link rel="manifest" href="../site.webmanifest">
<!-- mathjax math --><script src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script><script>
  window.MathJax = {
    chtml: {
      fontURL: "https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/output/chtml/fonts/woff-v2"
    }
  };
</script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Using optweight to Estimate Stable Balancing Weights">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">optweight</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.0.0.9004</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item"><a class="nav-link" href="../articles/optweight.html">Get started</a></li>
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/ngreifer/optweight/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Using optweight to Estimate Stable Balancing Weights</h1>
                        <h4 data-toc-skip class="author">Noah
Greifer</h4>
            
            <h4 data-toc-skip class="date">2026-01-15</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ngreifer/optweight/blob/master/vignettes/optweight.Rmd" class="external-link"><code>vignettes/optweight.Rmd</code></a></small>
      <div class="d-none name"><code>optweight.Rmd</code></div>
    </div>

    
    
<style>
pre {
overflow-x: auto;
}
pre code {
word-wrap: normal;
white-space: pre;
}
</style>
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p><em>optweight</em> implements stable balancing weighting (SBW) as
described by <span class="citation">Zubizarreta (<a href="#ref-zubizarretaStableWeightsThat2015">2015</a>)</span> and <span class="citation">Y. Wang and Zubizarreta (<a href="#ref-wangMinimalDispersionApproximately2020">2020</a>)</span>.
This involves estimating weights aimed at adjusting for confounding by
balancing covariates while minimizing some measure of variability of the
weights. SBW is also known as empirical balancing calibration weighting
<span class="citation">(<a href="#ref-chanGloballyEfficientNonparametric2016">Chan, Yam, and Zhang
2016</a>)</span> and entropy balancing <span class="citation">(<a href="#ref-kallbergLargeSampleProperties2023">Källberg and Waernbaum
2023</a>)</span>. These methods are related to inverse probability
weighting (IPW), and there are some equivalences between SBW and IPW
<span class="citation">(<a href="#ref-wangMinimalDispersionApproximately2020">Y. Wang and
Zubizarreta 2020</a>)</span>. While IPW typically involves fitting a
propensity score model for the probability of receiving treatment, SBW
estimates weights directly that balance the covariates. The distinction
between these two approaches is described in detail by <span class="citation">Chattopadhyay, Hase, and Zubizarreta (<a href="#ref-chattopadhyayBalancingVsModeling2020">2020</a>)</span>.</p>
<p>SBW involves solving the following optimization problem:</p>
<span class="math display">\[\begin{array}{crcll}
\min\limits_{\mathbf{w}} f\left(\mathbf{w}, \mathbf{b},\mathbf{s}\right)
&amp;  &amp; &amp; &amp; \\
\text{s.t.} &amp; \left| \bar{x}^{sw}_{k,a} - \bar{x}^{sw}_{k, a'}
\right| &amp; \le &amp; \delta_k &amp; \forall \{a, a'\} \in
\mathcal{A},\; \forall k \in \{1, \dots, K\} \\
&amp; \left| \frac{1}{2} \left( \bar{x}^{sw}_{k,a} + \bar{x}^{sw}_{k,
a'} \right) - \bar{x}_k^* \right| &amp; \le &amp; \varepsilon_k
&amp; \forall \{a, a'\} \in \mathcal{A},\; \forall k \in \{1, \dots,
K\} \\
&amp; w_i &amp; \ge &amp; w_\text{min} &amp; \forall i \\
&amp; \sum\limits_{i:A_i=a}s_i w_i &amp; = &amp;
\sum\limits_{i:A_i=a}s_i b_i &amp; \forall a \in \mathcal{A}
\end{array}\]</span>
<p>where</p>
<ul>
<li>
<span class="math inline">\(\mathbf{w}=\{w_1, \dots, w_n\}\)</span>
are the estimated weights</li>
<li>
<span class="math inline">\(\mathbf{s}=\{s_1, \dots, s_n\}\)</span>
are sampling weights</li>
<li>
<span class="math inline">\(\mathbf{b}=\{b_1, \dots, b_n\}\)</span>
are “base” weights</li>
<li>
<span class="math inline">\(f(\mathbf{w}, \mathbf{b},
\mathbf{s})\)</span> is the objective function to minimize—a function of
the estimated weights, base weights, and sampling weights</li>
<li>
<span class="math inline">\(A_i\)</span> is a categorical treatment
for unit <span class="math inline">\(i\)</span> taking on values <span class="math inline">\(a \in \mathcal{A}\)</span>
</li>
<li>
<span class="math inline">\(\bar{x}^{sw}_{k,a}\)</span> is the
weighted mean of covariate <span class="math inline">\(x_k\)</span> in
treatment group <span class="math inline">\(a\)</span>, weighted using
the product of <span class="math inline">\(\mathbf{s}\)</span> and <span class="math inline">\(\mathbf{w}\)</span> (i.e., <span class="math inline">\(\bar{x}^{sw}_{k,a} = \frac{\sum_{i:A_i=a} s_i w_i
x_{ki}}{\sum_{i:A_i=a} s_i w_i}\)</span>, where <span class="math inline">\(x_{ki}\)</span> is the value of covariate <span class="math inline">\(\mathbf{x}_k\)</span> for unit <span class="math inline">\(i\)</span>)</li>
<li>
<span class="math inline">\(\delta_k\)</span> is the group balance
tolerance for covariate <span class="math inline">\(k\)</span>
</li>
<li>
<span class="math inline">\(\varepsilon_k\)</span> is the target
balance tolerance for covariate <span class="math inline">\(k\)</span>
</li>
<li>
<span class="math inline">\(\bar{x}_k^*\)</span> is the target value
for covariate <span class="math inline">\(k\)</span>
</li>
<li>
<span class="math inline">\(w_\text{min}\)</span> is the minimum
weight allowed.</li>
</ul>
<p>The interpretation of these constraints is as follows:</p>
<ol style="list-style-type: decimal">
<li>
<strong>Group Balance.</strong> The weighted covariate means are
similar between groups (up to tolerance <span class="math inline">\(\delta_k\)</span>).</li>
<li>
<strong>Target Balance.</strong> The midpoints between weighted
covariate means in pairs of groups are similar to the target values (up
to tolerance <span class="math inline">\(\varepsilon_k\)</span>).</li>
<li>
<strong>Weight Range.</strong> All weights are larger than <span class="math inline">\(w_\text{min}\)</span>.</li>
<li>
<strong>Weight Scale.</strong> The weights sum to a fixed value in
each group.</li>
</ol>
<p>For a given dataset including treatment, covariates, sampling weights
(which may be all 1 if none are present), and base weights (which may be
all 1 if none are present), the user chooses <span class="math inline">\(\delta_k\)</span>, <span class="math inline">\(\bar{x}_k^*\)</span>, <span class="math inline">\(\varepsilon_k\)</span>, <span class="math inline">\(w_\text{min}\)</span>, and <span class="math inline">\(f\)</span>. Generally, <span class="math inline">\(f\)</span> represents a measure of dispersion from
the base weights, weighted by the sampling weights; see the section on
<a href="#norm"><code>norm</code></a> below.</p>
<p>Asymptotic properties of SBW are described in <span class="citation">Y. Wang and Zubizarreta (<a href="#ref-wangMinimalDispersionApproximately2020">2020</a>)</span>,
though the formulation in <em>optweight</em> differs slightly from the
original formulation in <span class="citation">Y. Wang and Zubizarreta
(<a href="#ref-wangMinimalDispersionApproximately2020">2020</a>)</span>
by allowing for an additional tuning parameter, <span class="math inline">\(\varepsilon_k\)</span>, to control target balance
separately from group balance. In general, the weights are precise and
perform well, and adding approximate balance constraints (i.e., using
<span class="math inline">\(\delta_k&gt;0\)</span>) tends to improve
precision without greatly affecting bias. There is also a weak
double-robustness property to the weights: the estimate is consistent if
either the outcome model corresponds to the balance constraints or the
implicit propensity score model corresponds to the true propensity score
model. Different forms of <span class="math inline">\(f\)</span> imply
different assumptions about the propensity score model. Allowing <span class="math inline">\(w_\text{min}\)</span> to be negative allows for
the possibility of negative weights, which can improve precision but
induce extrapolation. It turns out that using a linear regression model
for the outcome is equivalent to using SBW with the <span class="math inline">\(L_2\)</span> norm, <span class="math inline">\(\delta_k=0\)</span>, and <span class="math inline">\(\varepsilon_k=0\)</span>, and <span class="math inline">\(w_\text{min}=-\infty\)</span> <span class="citation">(<a href="#ref-chattopadhyayImpliedWeightsLinear2023">Chattopadhyay and
Zubizarreta 2023</a>)</span>.</p>
<p>Often <span class="math inline">\(\bar{x}_k^*\)</span> are chosen to
represent a known target group, like the full sample when targeting the
ATE or the treated group when targeting the ATT. They can also be chosen
to generalize the effect estimate to an arbitrary target population
<span class="citation">(<a href="#ref-chattopadhyayOneStepWeightingGeneralize2024">Chattopadhyay,
Cohn, and Zubizarreta 2024</a>)</span> or removed entirely to prioritize
group balance over target balance <span class="citation">(<a href="#ref-barnardPartiallyRetargetedBalancing2025">Barnard, Huling, and
Wolfson 2025</a>)</span>.</p>
<p>SBW can be generalized to continuous treatments, in which case
instead of balancing the covariate means, the treatment-covariate
covariances are constrained to be balanced. This was explored in <span class="citation">Greifer (<a href="#ref-greiferEstimatingBalancingWeights2020">2020</a>)</span>,
<span class="citation">Tübbicke (<a href="#ref-tubbickeEntropyBalancingContinuous2022">2022</a>)</span>, and
<span class="citation">Vegetabile et al. (<a href="#ref-vegetabileNonparametricEstimationPopulation2021">2021</a>)</span>.
SBW can also be used to directly weight a sample to resemble a
population, without needing to balance two treatment groups. This also
known known as matching-adjusted indirect comparison <span class="citation">Signorovitch et al. (<a href="#ref-signorovitchComparativeEffectivenessHeadtoHead2010">2010</a>)</span>.</p>
<p><em>optweight</em> contains functionality to perform these operations
and assess their performance. It was designed to be user-friendly,
compatible with the syntax used with <a href="https://ngreifer.github.io/WeightIt/" class="external-link"><em>WeightIt</em></a>, and
supported by <a href="https://ngreifer.github.io/cobalt/" class="external-link"><em>cobalt</em></a> for
balance assessment, at the possible expense of some flexibility. The <a href="https://cran.r-project.org/package=sbw" class="external-link"><em>sbw</em></a> package
also implements some of these methods, prioritizing different aspects of
the estimation. Entropy balancing is also implemented in
<em>WeightIt</em>, which can also call <em>optweight</em> to provide a
simpler interface to SBW.</p>
</div>
<div class="section level2">
<h2 id="using-optweight">Using <em>optweight</em><a class="anchor" aria-label="anchor" href="#using-optweight"></a>
</h2>
<p>The main function in <em>optweight</em> is <code><a href="../reference/optweight.html">optweight()</a></code>,
which uses a formula interface to specify the treatment, covariates, and
balance tolerance. Other functions in <em>optweight</em> facilitate
specification of more detailed parameters and support diagnostics.</p>
<p>Below, we’ll use <code><a href="../reference/optweight.html">optweight()</a></code> to estimate weights that
balance the covariates in an observational study. We’ll use the
<code>lalonde</code> dataset in <em>cobalt</em> and target the ATT
first. The treatment is <code>treat</code>, the outcome is
<code>re78</code>, and the other variables are the covariates to
balance.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/optweight/">optweight</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"lalonde"</span>, package <span class="op">=</span> <span class="st">"cobalt"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">lalonde</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   treat age educ   race married nodegree re74 re75    re78</span></span>
<span><span class="co">## 1     1  37   11  black       1        1    0    0  9930.0</span></span>
<span><span class="co">## 2     1  22    9 hispan       0        1    0    0  3595.9</span></span>
<span><span class="co">## 3     1  30   12  black       0        0    0    0 24909.5</span></span>
<span><span class="co">## 4     1  27   11  black       0        1    0    0  7506.1</span></span>
<span><span class="co">## 5     1  33    8  black       0        1    0    0   289.8</span></span>
<span><span class="co">## 6     1  22    9  black       0        1    0    0  4056.5</span></span></code></pre>
<p><code><a href="../reference/optweight.html">optweight()</a></code> can be used simply by supplying the
treatment and covariates to the <code>formula</code> argument, the
dataset to the <code>data</code> argument, and the estimand to the
<code>estimand</code> argument (here, the ATT). By default,
<code><a href="../reference/optweight.html">optweight()</a></code> minimizes the <span class="math inline">\(L_2\)</span> norm, requires exact mean balance on
the covariates (i.e., <span class="math inline">\(\delta_k=0\)</span>),
requires exact mean target balance on the covariates (i.e., <span class="math inline">\(\varepsilon_k=0\)</span>), and requires all
weights to be greater than <span class="math inline">\(w_\text{min}=10^{-8}\)</span>.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span>
<span><span class="va">ow</span></span></code></pre></div>
<pre><code><span><span class="co">## An <span style="font-style: italic;">optweight</span> object</span></span>
<span><span class="co">##  - number of obs.: 614</span></span>
<span><span class="co">##  - norm minimized: "l2"</span></span>
<span><span class="co">##  - sampling weights: present</span></span>
<span><span class="co">##  - base weights: present</span></span>
<span><span class="co">##  - treatment: 2-category</span></span>
<span><span class="co">##  - estimand: ATT (focal: 1)</span></span>
<span><span class="co">##  - covariates: age, educ, race, married, nodegree, re74, re75</span></span></code></pre>
<p>Using <code><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">cobalt::bal.tab()</a></code> on the output computes the
weighted balance statistics; in particular, it produce weighted
(standardized) mean differences for all covariates as well as the
effective sample size (ESS), which represents the approximate size of an
unweighted sample that produces the same precision as the weighted
sample.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Adj</span></span>
<span><span class="co">## age         Contin.       -0</span></span>
<span><span class="co">## educ        Contin.       -0</span></span>
<span><span class="co">## race_black   Binary       -0</span></span>
<span><span class="co">## race_hispan  Binary        0</span></span>
<span><span class="co">## race_white   Binary        0</span></span>
<span><span class="co">## married      Binary       -0</span></span>
<span><span class="co">## nodegree     Binary       -0</span></span>
<span><span class="co">## re74        Contin.       -0</span></span>
<span><span class="co">## re75        Contin.       -0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.      185</span></span>
<span><span class="co">## Adjusted     108.6     185</span></span></code></pre>
<p>As expected, all mean differences are exactly 0 in the weighted
sample. We can use <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> to examine some properties of
the weights:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight ranges</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##         Min                                 Max</span></span>
<span><span class="co">## treated   1      ||                       1.   </span></span>
<span><span class="co">## control   0 |---------------------------| 6.002</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Units with the 5 most extreme weights by group</span>:</span></span>
<span><span class="co">##                                      </span></span>
<span><span class="co">##              1     2    3     4     5</span></span>
<span><span class="co">##  treated     1     1    1     1     1</span></span>
<span><span class="co">##            423   388  226   196   118</span></span>
<span><span class="co">##  control 5.568 5.602 5.67 5.922 6.002</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            L2    L1    L∞ Rel Ent # Zeros</span></span>
<span><span class="co">## treated 0.    0.    0.       0.         0</span></span>
<span><span class="co">## control 1.717 1.339 5.002    1.23       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unweighted   429.      185</span></span>
<span><span class="co">## Weighted     108.6     185</span></span></code></pre>
<p><code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> produces some information about the
distribution of weights, including different measures of the dispersion
of the weights, each of which corresponds to one of the allowed
objective functions to minimize. <code>L2</code> is the square root of
the mean squared deviation of the estimated weights from the base
weights (i.e., the <span class="math inline">\(L_2\)</span> divergence);
here, the base weights are all 1. See the help page for
<code><a href="../reference/summary.optweight.html">summary.optweight()</a></code> for more information about the other
statistics. Lastly, <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> produces the weighted and
original (effective) samples sizes.</p>
<p>We can use <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code> on the <code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> output
to visualize the distribution of the weights:</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow</span><span class="op">)</span> <span class="op">|&gt;</span> <span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="optweight_files/figure-html/unnamed-chunk-4-1.png" class="r-plt" alt="" width="576"></p>
<p>Because we targeted the ATT, only the weights for the control group
are displayed (the treated group weights are all 1).</p>
<p>Below, we’ll adjust a few arguments to see what affects they have on
the weights.</p>
<div class="section level3">
<h3 id="balance-tolerance-tols">Balance tolerance: <code>tols</code><a class="anchor" aria-label="anchor" href="#balance-tolerance-tols"></a>
</h3>
<p>The group balance tolerance is controlled by the <code>tols</code>
argument. This can either be a single value applied to all covariates or
a vector with a value for each covariate. By default,
<code>tols = 0</code>. Let’s see what happens when we increase
<code>tols</code> to .02.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                 tols <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow2</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Adj</span></span>
<span><span class="co">## age         Contin.     0.02</span></span>
<span><span class="co">## educ        Contin.     0.02</span></span>
<span><span class="co">## race_black   Binary     0.02</span></span>
<span><span class="co">## race_hispan  Binary     0.00</span></span>
<span><span class="co">## race_white   Binary    -0.02</span></span>
<span><span class="co">## married      Binary    -0.02</span></span>
<span><span class="co">## nodegree     Binary     0.02</span></span>
<span><span class="co">## re74        Contin.    -0.02</span></span>
<span><span class="co">## re75        Contin.     0.02</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.      185</span></span>
<span><span class="co">## Adjusted     118.8     185</span></span></code></pre>
<p>Now, all mean differences are less than .02<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that by default, &lt;code&gt;&lt;a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link"&gt;cobalt::bal.tab()&lt;/a&gt;&lt;/code&gt;
reports standardized mean differences for continuous variables and raw
mean differences for binary variables. &lt;code&gt;&lt;a href="../reference/optweight.html"&gt;optweight()&lt;/a&gt;&lt;/code&gt;
standardizes the balance tolerances the same way: by default,
&lt;code&gt;tols&lt;/code&gt; refers to the largest standardized mean difference
allowed for continuous variables and the largest raw mean difference for
binary variables. To change whether tolerances for binary or continuous
variables should be in standardized units or not, see the
&lt;code&gt;std.binary&lt;/code&gt; and &lt;code&gt;std.cont&lt;/code&gt; arguments of
&lt;code&gt;&lt;a href="../reference/optweight.html"&gt;optweight.fit()&lt;/a&gt;&lt;/code&gt;, which &lt;code&gt;&lt;a href="../reference/optweight.html"&gt;optweight()&lt;/a&gt;&lt;/code&gt; calls under
the hood.&lt;/p&gt;'><sup>1</sup></a>.</p>
<p>Allowing for more relaxed imbalance also increases the ESS. The <span class="math inline">\(L_2\)</span> statistic has shrunk
correspondingly:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow2</span>, weight.range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            L2    L1    L∞ Rel Ent # Zeros</span></span>
<span><span class="co">## treated 0.    0.    0.      0.          0</span></span>
<span><span class="co">## control 1.616 1.267 4.212   1.118       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unweighted   429.      185</span></span>
<span><span class="co">## Weighted     118.8     185</span></span></code></pre>
<p>To supply each covariate with its own balance tolerance, a named
vector must be supplied. This can sometimes be a little tedious, so
there is a helper function, <code><a href="../reference/process_tols.html">process_tols()</a></code>, that simplifies
this. Give <code><a href="../reference/process_tols.html">process_tols()</a></code> the formula and dataset (and,
optionally, an initial tolerance value or vector thereof), and it will
return a modifiable vector of balance tolerances that can be supplied to
<code><a href="../reference/optweight.html">optweight()</a></code>.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_tols.html">process_tols</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                       <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                     tols <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span></span>
<span><span class="va">tols</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">tols</span>:</span></span>
<span><span class="co">##      age     educ     race  married nodegree     re74     re75 </span></span>
<span><span class="co">##     0.02     0.02     0.02     0.02     0.02     0.02     0.02</span></span></code></pre>
<p>Here, we’ll relax the constraint on <code>race</code> by setting its
group balance tolerance to .07 and then re-estimate the weights.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span><span class="op">[</span><span class="st">"race"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.07</span></span>
<span></span>
<span><span class="va">tols</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">tols</span>:</span></span>
<span><span class="co">##      age     educ     race  married nodegree     re74     re75 </span></span>
<span><span class="co">##     0.02     0.02     0.07     0.02     0.02     0.02     0.02</span></span></code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                 tols <span class="op">=</span> <span class="va">tols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow3</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.Adj</span></span>
<span><span class="co">## age         Contin.     0.02</span></span>
<span><span class="co">## educ        Contin.     0.02</span></span>
<span><span class="co">## race_black   Binary     0.07</span></span>
<span><span class="co">## race_hispan  Binary     0.00</span></span>
<span><span class="co">## race_white   Binary    -0.07</span></span>
<span><span class="co">## married      Binary    -0.02</span></span>
<span><span class="co">## nodegree     Binary     0.02</span></span>
<span><span class="co">## re74        Contin.    -0.02</span></span>
<span><span class="co">## re75        Contin.     0.02</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.      185</span></span>
<span><span class="co">## Adjusted     132.7     185</span></span></code></pre>
<p>We can see that for all covariates other than <code>race</code>, the
mean differences are at or below .02, but for <code>race</code>, the
mean differences are at or below .07. This led to an increase in ESS due
to the relaxed constraints.</p>
</div>
<div class="section level3">
<h3 id="norm">Objective function: <code>norm</code><a class="anchor" aria-label="anchor" href="#norm"></a>
</h3>
<p>The <code>norm</code> argument controls which objective function is
used. See the table below for the allowable values of <code>norm</code>,
their names, and their formulas:</p>
<table class="table">
<colgroup>
<col width="19%">
<col width="26%">
<col width="53%">
</colgroup>
<thead><tr class="header">
<th align="center"><code>norm</code></th>
<th align="center">Name</th>
<th align="left"><span class="math inline">\(f\left(\mathbf{w},
\mathbf{b},\mathbf{s}\right)\)</span></th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center"><code>"l2"</code></td>
<td align="center">
<span class="math inline">\(L_2\)</span> norm</td>
<td align="left"><span class="math inline">\(\frac{1}{n}\sum_i{s_i(w_i-b_i)^2}\)</span></td>
</tr>
<tr class="even">
<td align="center"><code>"l1"</code></td>
<td align="center">
<span class="math inline">\(L_1\)</span> norm</td>
<td align="left"><span class="math inline">\(\frac{1}{n} \sum_i {s_i
\vert w_i - b_i \vert}\)</span></td>
</tr>
<tr class="odd">
<td align="center"><code>"linf"</code></td>
<td align="center">
<span class="math inline">\(L_\infty\)</span>
norm</td>
<td align="left"><span class="math inline">\(\max_i {\vert w_i - b_i
\vert}\)</span></td>
</tr>
<tr class="even">
<td align="center"><code>"entropy"</code></td>
<td align="center">Relative entropy</td>
<td align="left"><span class="math inline">\(\frac{1}{n} \sum_i {s_i w_i
\log \frac{w_i}{b_i}}\)</span></td>
</tr>
<tr class="odd">
<td align="center"><code>"log"</code></td>
<td align="center">Sum of negative logs</td>
<td align="left"><span class="math inline">\(\frac{1}{n} \sum_i {-s_i
\log \frac{w_i}{b_i}}\)</span></td>
</tr>
</tbody>
</table>
<p>The <span class="math inline">\(L_2\)</span> norm is the default. Of
all the objective functions, the most thorough theoretical work has been
done on the <span class="math inline">\(L_2\)</span> norm and relative
entropy, and these tend to be the easiest to optimize. Weighting by
minimizing the relative entropy is also known as “entropy balancing”
<span class="citation">(<a href="#ref-hainmuellerEntropyBalancingCausal2012">Hainmueller 2012</a>;
<a href="#ref-kallbergLargeSampleProperties2023">Källberg and Waernbaum
2023</a>; <a href="#ref-zhaoEntropyBalancingDoubly2017">Zhao and
Percival 2017</a>)</span> and is also available in <em>WeightIt</em>,
which uses a more parsimonious representation of the problem. Weighting
by minimizing the sum of negative logs is equivalent to nonparametric
covariate balancing propensity score (npCBPS) weighting <span class="citation">(<a href="#ref-fongCovariateBalancingPropensity2018">Fong, Hazlett, and Imai
2018</a>)</span>, which maximizes the empirical likelihood of the data
to estimate the weights. A penalized version of npCBPS is available in
<a href="https://cran.r-project.org/package=CBPS" class="external-link"><em>CBPS</em></a> and
in <em>WeightIt</em> (which calls functions from <em>CBPS</em>), but
<em>optweight</em> offers additional options not possible in those
packages, such as specifying balance tolerances, targets, and different
estimands.</p>
<p>Different solvers are available for each norm; see the
<code><a href="../reference/optweight.html">optweight()</a></code> help page for details.</p>
<p>Below, we’ll minimize the <span class="math inline">\(L_2\)</span>
norm, <span class="math inline">\(L_1\)</span> norm, <span class="math inline">\(L_\infty\)</span> norm, and relative entropy and
see how those choices affect the properties of the weights.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># L2 norm</span></span>
<span><span class="va">ow_l2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                     <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                   estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                   norm <span class="op">=</span> <span class="st">"l2"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># L1 norm</span></span>
<span><span class="va">ow_l1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                     <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                   estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                   norm <span class="op">=</span> <span class="st">"l1"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># L-infinity norm</span></span>
<span><span class="va">ow_linf</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                       <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                     estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                     norm <span class="op">=</span> <span class="st">"linf"</span>,</span>
<span>                     eps <span class="op">=</span> <span class="fl">1e-5</span><span class="op">)</span> <span class="co"># to improve convergence</span></span>
<span><span class="co"># Relative entropy</span></span>
<span><span class="va">ow_re</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                     <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                   estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                   norm <span class="op">=</span> <span class="st">"entropy"</span><span class="op">)</span></span></code></pre></div>
<p>Below is a table of the statistics (rows) for the control group for
each norm minimized (columns).</p>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="right">l2</th>
<th align="right">l1</th>
<th align="right">linf</th>
<th align="right">RE</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">L2</td>
<td align="right">1.717</td>
<td align="right">2.017</td>
<td align="right">1.877</td>
<td align="right">1.832</td>
</tr>
<tr class="even">
<td align="left">L1</td>
<td align="right">1.339</td>
<td align="right">1.281</td>
<td align="right">1.548</td>
<td align="right">1.287</td>
</tr>
<tr class="odd">
<td align="left">L∞</td>
<td align="right">5.002</td>
<td align="right">9.924</td>
<td align="right">3.577</td>
<td align="right">8.421</td>
</tr>
<tr class="even">
<td align="left">Rel Ent</td>
<td align="right">1.230</td>
<td align="right">1.227</td>
<td align="right">1.500</td>
<td align="right">1.101</td>
</tr>
</tbody>
</table>
<p>We can see that minimizing the <span class="math inline">\(L_2\)</span> norm yields weights that have the
lowest <span class="math inline">\(L_2\)</span> divergence, minimizing
the <span class="math inline">\(L_1\)</span> norm yields weights that
have the lowest <span class="math inline">\(L_1\)</span> divergence,
minimizing the <span class="math inline">\(L_\infty\)</span> norm yields
weights that have the lowest <span class="math inline">\(L_\infty\)</span> divergence, and minimizing the
relative entropy yields weights that have the lowest relative entropy.
The <span class="math inline">\(L_2\)</span> divergence has the closest
correspondence to the ESS (they have a 1:1 relationship), but there are
some theoretical reasons to prefer other norms, especially when they
correspond to certain assumptions about the true propensity score model.
See <span class="citation">Källberg and Waernbaum (<a href="#ref-kallbergLargeSampleProperties2023">2023</a>)</span> for more
information on these assumptions.</p>
</div>
<div class="section level3">
<h3 id="representativeness-estimand-targets-and-target-tols">Representativeness: <code>estimand</code>, <code>targets</code>, and
<code>target.tols</code><a class="anchor" aria-label="anchor" href="#representativeness-estimand-targets-and-target-tols"></a>
</h3>
<p>Representativeness is an important but occasionally neglected aspect
of weighting. The degree to which a given weighted sample can be
representative of a specific target population can be controlled by the
<code>estimand</code>, <code>target</code>, and <code>target.tols</code>
arguments, which we detail below.</p>
<div class="section level4">
<h4 id="estimand">
<code>estimand</code><a class="anchor" aria-label="anchor" href="#estimand"></a>
</h4>
<p>Different estimands can be targeted by supplying an argument to
<code>estimand</code>. Allowable estimands include the ATE, ATT, and
ATC. These ensure the covariate means in each group resemble those in
the full sample, the treated group, and the control group, respectively.
For example, setting <code>estimand = "ATE"</code> requests that both
groups be weighted so that the covariate means are equal to the
covariate means in the full sample, as demonstrated below.</p>
<p>The covariate means in the full sample can be computed using
<code><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">cobalt::col_w_mean()</a></code>:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">covs</span> <span class="op">&lt;-</span> <span class="va">lalonde</span><span class="op">[</span><span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">9</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">col_w_mean</a></span><span class="op">(</span><span class="va">covs</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##     27.3632     10.2687      0.3958      0.1173      0.4870      0.4153 </span></span>
<span><span class="co">##    nodegree        re74        re75 </span></span>
<span><span class="co">##      0.6303   4557.5466   2184.9382</span></span></code></pre>
<p>After estimating weights that target the ATE, we will see that the
weighted covariate means in each group are equal to those in the full
sample:</p>
<div class="sourceCode" id="cb23"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_ate</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                      <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                    estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow_ate</span>, disp <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type  M.0.Adj  M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   27.363   27.363        0</span></span>
<span><span class="co">## educ        Contin.   10.269   10.269        0</span></span>
<span><span class="co">## race_black   Binary    0.396    0.396        0</span></span>
<span><span class="co">## race_hispan  Binary    0.117    0.117        0</span></span>
<span><span class="co">## race_white   Binary    0.487    0.487       -0</span></span>
<span><span class="co">## married      Binary    0.415    0.415        0</span></span>
<span><span class="co">## nodegree     Binary    0.630    0.630        0</span></span>
<span><span class="co">## re74        Contin. 4557.547 4557.547        0</span></span>
<span><span class="co">## re75        Contin. 2184.938 2184.938        0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.   185.  </span></span>
<span><span class="co">## Adjusted     343.5   50.72</span></span></code></pre>
</div>
<div class="section level4">
<h4 id="targets">
<code>targets</code><a class="anchor" aria-label="anchor" href="#targets"></a>
</h4>
<p>In addition to targeting a natural sample, it’s also possible to
target a specific population characterized by covariate means <span class="math inline">\(\bar{x}_k^*\)</span> by supplying an argument to
<code>targets</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Indeed, using &lt;code&gt;estimand&lt;/code&gt; is just a shortcut
to using &lt;code&gt;targets&lt;/code&gt; when the target population is one of those
supported by &lt;code&gt;estimand&lt;/code&gt;.&lt;/p&gt;"><sup>2</sup></a>. The theory behind this methodology is
described by <span class="citation">Chattopadhyay, Cohn, and Zubizarreta
(<a href="#ref-chattopadhyayOneStepWeightingGeneralize2024">2024</a>)</span>.
To request a different target population, <code><a href="../reference/process_targets.html">process_targets()</a></code>
can be used to create a vector of target means, which are supplied to
the <code>targets</code> argument of <code><a href="../reference/optweight.html">optweight()</a></code>.</p>
<div class="sourceCode" id="cb25"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targets1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_targets.html">process_targets</a></span><span class="op">(</span><span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                              <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span>
<span></span>
<span><span class="va">targets1</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">targets</span>:</span></span>
<span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##     27.3632     10.2687      0.3958      0.1173      0.4870      0.4153 </span></span>
<span><span class="co">##    nodegree        re74        re75 </span></span>
<span><span class="co">##      0.6303   4557.5466   2184.9382</span></span></code></pre>
<p>By default, <code><a href="../reference/process_targets.html">process_targets()</a></code> computes the mean of each
covariate in the full sample. These can be modified similarly to
<code>tols</code> to specify target means. Note that for categorical
covariates, the proportions in the groups must sum to 1.</p>
<div class="sourceCode" id="cb27"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targets1</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">35</span></span>
<span><span class="va">targets1</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race_black"</span>, <span class="st">"race_hispan"</span>, <span class="st">"race_white"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.5</span>, <span class="fl">.3</span>, <span class="fl">.2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">targets1</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">targets</span>:</span></span>
<span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##     35.0000     10.2687      0.5000      0.3000      0.2000      0.4153 </span></span>
<span><span class="co">##    nodegree        re74        re75 </span></span>
<span><span class="co">##      0.6303   4557.5466   2184.9382</span></span></code></pre>
<p>We can supply these to <code><a href="../reference/optweight.html">optweight()</a></code> to request that the
covariate means in the weighted sample are equal to these target means.
We need to set <code>estimand = NULL</code> to ensure the
<code>targets</code> are obeyed. Failing to do this will produce a
warning.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_target1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                          <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                        targets <span class="op">=</span> <span class="va">targets1</span>,</span>
<span>                        estimand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow_target1</span>, disp <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type  M.0.Adj  M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   35.000   35.000       -0</span></span>
<span><span class="co">## educ        Contin.   10.269   10.269       -0</span></span>
<span><span class="co">## race_black   Binary    0.500    0.500       -0</span></span>
<span><span class="co">## race_hispan  Binary    0.300    0.300        0</span></span>
<span><span class="co">## race_white   Binary    0.200    0.200        0</span></span>
<span><span class="co">## married      Binary    0.415    0.415       -0</span></span>
<span><span class="co">## nodegree     Binary    0.630    0.630       -0</span></span>
<span><span class="co">## re74        Contin. 4557.547 4557.547       -0</span></span>
<span><span class="co">## re75        Contin. 2184.938 2184.938       -0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.    185. </span></span>
<span><span class="co">## Adjusted     133.5    25.6</span></span></code></pre>
<p>The treatment effect estimate from this method of weighting would
have the interpretation of the estimate from a population with similar
means to those of the sample but with a mean age of 35 years (older than
the original sample) and a racial profile of 50% Black, 30% Hispanic,
and 20% white.</p>
<p>It may be that representativeness to a specific target population is
only desired for a subset of variables, e.g., those expected to be
effect modifiers. We can remove constraints on target balance entirely
for certain variable by setting their target values to <code>NA</code>.
This can be especially helpful in cases of low overlap, as described by
<span class="citation">Barnard, Huling, and Wolfson (<a href="#ref-barnardPartiallyRetargetedBalancing2025">2025</a>)</span>. We
do this below, setting the targets for the <code>race</code> categories
to <code>NA</code>:</p>
<div class="sourceCode" id="cb31"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targets2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_targets.html">process_targets</a></span><span class="op">(</span><span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                              <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Set race targets to NA</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">targets2</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/startsWith.html" class="external-link">startsWith</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">targets2</span><span class="op">)</span>, <span class="st">"race_"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="va">ow_target2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                          <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                        targets <span class="op">=</span> <span class="va">targets2</span>,</span>
<span>                        estimand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow_target2</span>, disp <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type  M.0.Adj  M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   27.363   27.363        0</span></span>
<span><span class="co">## educ        Contin.   10.269   10.269        0</span></span>
<span><span class="co">## race_black   Binary    0.451    0.451        0</span></span>
<span><span class="co">## race_hispan  Binary    0.164    0.164       -0</span></span>
<span><span class="co">## race_white   Binary    0.386    0.386       -0</span></span>
<span><span class="co">## married      Binary    0.415    0.415        0</span></span>
<span><span class="co">## nodegree     Binary    0.630    0.630        0</span></span>
<span><span class="co">## re74        Contin. 4557.547 4557.547        0</span></span>
<span><span class="co">## re75        Contin. 2184.938 2184.938        0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.   185.  </span></span>
<span><span class="co">## Adjusted     299.5   63.03</span></span></code></pre>
<p>The resulting weights still ensure between-group balance (up to the
supplied <code>tols</code>), but the resulting weighted means for the
untargeted variables are those that happened to optimize the norm of the
weights. We can even relax all target constraints to solely prioritize
between-group balance by setting <code>targets = NA</code>.</p>
<div class="sourceCode" id="cb33"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_target3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                          <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                        data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                        targets <span class="op">=</span> <span class="cn">NA</span>,</span>
<span>                        estimand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow_target3</span>, disp <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type  M.0.Adj  M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   25.877   25.877       -0</span></span>
<span><span class="co">## educ        Contin.   10.318   10.318        0</span></span>
<span><span class="co">## race_black   Binary    0.454    0.454       -0</span></span>
<span><span class="co">## race_hispan  Binary    0.166    0.166        0</span></span>
<span><span class="co">## race_white   Binary    0.380    0.380        0</span></span>
<span><span class="co">## married      Binary    0.319    0.319       -0</span></span>
<span><span class="co">## nodegree     Binary    0.626    0.626       -0</span></span>
<span><span class="co">## re74        Contin. 3316.369 3316.369        0</span></span>
<span><span class="co">## re75        Contin. 1994.888 1994.888        0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.   185.  </span></span>
<span><span class="co">## Adjusted     283.1   76.99</span></span></code></pre>
<p>This yields a kind of “overlap” weights that target whichever
population optimizes the objective function of the weights subject to
between-group balance alone <span class="citation">(<a href="#ref-kallusOptimalEstimationGeneralized2019">Kallus and
Santacatterina 2019</a>)</span>.</p>
</div>
<div class="section level4">
<h4 id="target-tols">
<code>target.tols</code><a class="anchor" aria-label="anchor" href="#target-tols"></a>
</h4>
<p>Between eschewing target balance altogether and requiring exact
target balance is allowing for inexact target balance by using
<code>target.tols</code>, which is specified like to <code>tols</code>
argument. <code>target.tols</code> controls <span class="math inline">\(\varepsilon_k\)</span>, i.e., how far the midpoint
between group means can vary from the specified target mean. As with
<code>tols</code>, this can be applied to a subset of covariates or to
all of them simultaneously.</p>
<p>Previously, we used <code><a href="../reference/optweight.html">optweight()</a></code> to target a specific
target population defined by <code>targets1</code>; the resulting
weights are stored in <code>ow_target1</code>. We can increase the ESS
by relaxing the target balance constraint on <code>race</code>. To do
this, we create a new vector of target balance tolerances using
<code><a href="../reference/process_tols.html">process_tols()</a></code> and modify the value for
<code>race</code>.</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target.tols1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_tols.html">process_tols</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                               <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                             data <span class="op">=</span> <span class="va">lalonde</span><span class="op">)</span></span>
<span></span>
<span><span class="va">target.tols1</span><span class="op">[</span><span class="st">"race"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.07</span></span>
<span></span>
<span><span class="va">target.tols1</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">tols</span>:</span></span>
<span><span class="co">##      age     educ     race  married nodegree     re74     re75 </span></span>
<span><span class="co">##     0.00     0.00     0.07     0.00     0.00     0.00     0.00</span></span></code></pre>
<p>We can supply this vector of target balance tolerances to the
<code>target.tols</code> argument of <code><a href="../reference/optweight.html">optweight()</a></code> to relax
the target balance constraint without eliminating it entirely.</p>
<div class="sourceCode" id="cb37"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_target1b</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                           <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                         targets <span class="op">=</span> <span class="va">targets1</span>,</span>
<span>                         target.tols <span class="op">=</span> <span class="va">target.tols1</span>,</span>
<span>                         estimand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow_target1b</span>, disp <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type  M.0.Adj  M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   35.000   35.000       -0</span></span>
<span><span class="co">## educ        Contin.   10.269   10.269       -0</span></span>
<span><span class="co">## race_black   Binary    0.522    0.522       -0</span></span>
<span><span class="co">## race_hispan  Binary    0.230    0.230        0</span></span>
<span><span class="co">## race_white   Binary    0.248    0.248        0</span></span>
<span><span class="co">## married      Binary    0.415    0.415       -0</span></span>
<span><span class="co">## nodegree     Binary    0.630    0.630       -0</span></span>
<span><span class="co">## re74        Contin. 4557.547 4557.547       -0</span></span>
<span><span class="co">## re75        Contin. 2184.938 2184.938       -0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.   185.  </span></span>
<span><span class="co">## Adjusted     148.4   31.26</span></span></code></pre>
<p>Here we can see that the ESS has increased due to relaxing the
constraint on target balance, but the means for each <code>race</code>
category are still close to (i.e., within 0.07 of) their specified
target values.</p>
<p>If we wanted to remove a covariate’s target balance constraint
entirely, we could set its target value to <code>NA</code>, as we did
previously, or we can set its target balance tolerance to
<code>Inf</code>, which we do below for <code>age</code>:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">target.tols1</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="cn">Inf</span></span>
<span></span>
<span><span class="va">target.tols1</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">tols</span>:</span></span>
<span><span class="co">##      age     educ     race  married nodegree     re74     re75 </span></span>
<span><span class="co">##      Inf     0.00     0.07     0.00     0.00     0.00     0.00</span></span></code></pre>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_target1c</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                           <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                         data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                         targets <span class="op">=</span> <span class="va">targets1</span>,</span>
<span>                         target.tols <span class="op">=</span> <span class="va">target.tols1</span>,</span>
<span>                         estimand <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">ow_target1c</span>, disp <span class="op">=</span> <span class="st">"m"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type  M.0.Adj  M.1.Adj Diff.Adj</span></span>
<span><span class="co">## age         Contin.   26.495   26.495        0</span></span>
<span><span class="co">## educ        Contin.   10.269   10.269       -0</span></span>
<span><span class="co">## race_black   Binary    0.500    0.500        0</span></span>
<span><span class="co">## race_hispan  Binary    0.230    0.230       -0</span></span>
<span><span class="co">## race_white   Binary    0.270    0.270       -0</span></span>
<span><span class="co">## married      Binary    0.415    0.415        0</span></span>
<span><span class="co">## nodegree     Binary    0.630    0.630        0</span></span>
<span><span class="co">## re74        Contin. 4557.547 4557.547        0</span></span>
<span><span class="co">## re75        Contin. 2184.938 2184.938        0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unadjusted   429.   185.  </span></span>
<span><span class="co">## Adjusted     246.7   71.72</span></span></code></pre>
<p>In general, it makes sense to maintain strict target balance
constraints on all covariates, relaxing them only when the covariate is
not suspected to be an effect modifier (i.e., so representativeness on
that covariate is not important) or when substantial precision gains can
be made by doing so. The <a href="#dual-variables">section on Dual
Variables</a> below describes how to determine whether the latter
scenario may be in effect.</p>
</div>
</div>
<div class="section level3">
<h3 id="sampling-weights-and-base-weights">Sampling weights and base weights<a class="anchor" aria-label="anchor" href="#sampling-weights-and-base-weights"></a>
</h3>
<p>Sampling weights and base weights are different forms of initially
computed weights that can be used to modify the optimization problem.
They are used for two different purposes, which we describe below.</p>
<div class="section level4">
<h4 id="sampling-weights-s-weights">Sampling weights: <code>s.weights</code><a class="anchor" aria-label="anchor" href="#sampling-weights-s-weights"></a>
</h4>
<p>Sampling weights are used when attempting to generalize the estimates
from a sample to a specific target population characterized by the
sampling weights. Some datasets come with sampling weights in order for
analyses using them to be valid. These weights can be supplied to the
<code>s.weights</code> argument of <code><a href="../reference/optweight.html">optweight()</a></code>. This has
three effects:</p>
<ol style="list-style-type: decimal">
<li>The balance and target constraints correspond to the product of the
estimated and sampling weights</li>
<li>The target values for the covariates are weighted by the sampling
weights (if not supplied through <code>targets</code>)</li>
<li>The contribution of the estimated weights to the objective function
is weighted by the sampling weights</li>
</ol>
<p>Sampling weights are also used when bootstrapping using the
fractional weighted bootstrap <span class="citation">(<a href="#ref-xuApplicationsFractionalRandomWeightBootstrap2020a">Xu et al.
2020</a>)</span>, e.g., as implemented in the <a href="https://ngreifer.github.io/fwb/" class="external-link"><em>fwb</em></a> package; see
section <a href="#est-effects">Estimating Effects</a> below. By default,
when <code>s.weights</code> is not specified, sampling weights are equal
to 1.</p>
</div>
<div class="section level4">
<h4 id="base-weights-b-weights">Base weights: <code>b.weights</code><a class="anchor" aria-label="anchor" href="#base-weights-b-weights"></a>
</h4>
<p>Base weights are a set of initial weights that have some properties
that the user wants to retain while enforcing balance constraints. The
estimated weights are chosen to minimize their distance from the base
weights, where that distance corresponds to <span class="math inline">\(f\)</span>. These weights can be supplied to the
<code>b.weights</code> argument of <code><a href="../reference/optweight.html">optweight()</a></code>. By default,
when not specified, base weights are equal to 1. An example use of base
weights would be to enforce balance on a set of IPW weights estimated
using a flexible model that is unable to exactly balance the covariates.
This strategy was used by one of the winning methods in the 2016 ACIC
data competition <span class="citation">(<a href="#ref-dorieAutomatedDoityourselfMethods2019">Dorie et al.
2019</a>)</span>. We’ll demonstrate this use of base weights below.</p>
<p>First, we’ll estimate propensity score weights using generalized
boosted modeling through <em>WeightIt</em>. This is a flexible machine
learning model, and we can request that features beyond the covariate
means be balanced by minimizing the largest Kolmogorov-Smirnov (KS)
statistic in the weighted sample.</p>
<div class="sourceCode" id="cb43"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># GBM IPW weights</span></span>
<span><span class="va">W_gbm</span> <span class="op">&lt;-</span> <span class="fu">WeightIt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">weightit</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                              <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                            data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                            estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                            method <span class="op">=</span> <span class="st">"gbm"</span>,</span>
<span>                            criterion <span class="op">=</span> <span class="st">"ks.max"</span><span class="op">)</span></span></code></pre></div>
<p>Next we’ll use <code><a href="../reference/optweight.html">optweight()</a></code> to estimate a set of weights
that differ as little as possible from these estimated weights while
enforcing exact balance on the covariate means.</p>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SBW with GBM base weights</span></span>
<span><span class="va">ow_bw</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                     <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                   data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                   estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                   b.weights <span class="op">=</span> <span class="va">W_gbm</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></code></pre></div>
<p>We’ll also estimate SBW weights with uniform base weights to see the
difference in the properties of the weights.</p>
<div class="sourceCode" id="cb45"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># SBW without base weights</span></span>
<span><span class="va">ow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                estimand <span class="op">=</span> <span class="st">"ATT"</span><span class="op">)</span></span></code></pre></div>
<p>Finally, we can look at balance on all three sets of weights on the
means and KS statistics.</p>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Mean diferences</span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W_gbm</span>, stats <span class="op">=</span> <span class="st">"m"</span>,</span>
<span>                weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ow_bw <span class="op">=</span> <span class="va">ow_bw</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>                               ow <span class="op">=</span> <span class="va">ow</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                 Type Diff.weightit Diff.ow_bw Diff.ow</span></span>
<span><span class="co">## prop.score  Distance         0.577      0.571   1.782</span></span>
<span><span class="co">## age          Contin.         0.053      0.000  -0.000</span></span>
<span><span class="co">## educ         Contin.        -0.080     -0.000  -0.000</span></span>
<span><span class="co">## race_black    Binary         0.017      0.000  -0.000</span></span>
<span><span class="co">## race_hispan   Binary         0.002     -0.000   0.000</span></span>
<span><span class="co">## race_white    Binary        -0.018     -0.000   0.000</span></span>
<span><span class="co">## married       Binary         0.005      0.000  -0.000</span></span>
<span><span class="co">## nodegree      Binary         0.062      0.000  -0.000</span></span>
<span><span class="co">## re74         Contin.         0.111      0.000  -0.000</span></span>
<span><span class="co">## re75         Contin.         0.126      0.000  -0.000</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##          Control Treated</span></span>
<span><span class="co">## All       429.       185</span></span>
<span><span class="co">## weightit   24.71     185</span></span>
<span><span class="co">## ow_bw      24.54     185</span></span>
<span><span class="co">## ow        108.64     185</span></span></code></pre>
<div class="sourceCode" id="cb48"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># KS statistics</span></span>
<span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">W_gbm</span>, stats <span class="op">=</span> <span class="st">"ks"</span>,</span>
<span>                weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ow_bw <span class="op">=</span> <span class="va">ow_bw</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>                               ow <span class="op">=</span> <span class="va">ow</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                 Type KS.weightit KS.ow_bw KS.ow</span></span>
<span><span class="co">## prop.score  Distance       0.223    0.222 0.615</span></span>
<span><span class="co">## age          Contin.       0.096    0.102 0.283</span></span>
<span><span class="co">## educ         Contin.       0.069    0.057 0.042</span></span>
<span><span class="co">## race_black    Binary       0.017    0.000 0.000</span></span>
<span><span class="co">## race_hispan   Binary       0.002    0.000 0.000</span></span>
<span><span class="co">## race_white    Binary       0.018    0.000 0.000</span></span>
<span><span class="co">## married       Binary       0.005    0.000 0.000</span></span>
<span><span class="co">## nodegree      Binary       0.062    0.000 0.000</span></span>
<span><span class="co">## re74         Contin.       0.062    0.037 0.226</span></span>
<span><span class="co">## re75         Contin.       0.096    0.056 0.140</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##          Control Treated</span></span>
<span><span class="co">## All       429.       185</span></span>
<span><span class="co">## weightit   24.71     185</span></span>
<span><span class="co">## ow_bw      24.54     185</span></span>
<span><span class="co">## ow        108.64     185</span></span></code></pre>
<p>Looking at the mean differences (in the columns
<code>Diff.weightit</code>, <code>Diff.ow_bw</code>, and
<code>Diff.ow</code> in the first table), we can see that the GBM
weights from <em>WeightIt</em> alone did not balance the covariate
means, whereas both set of SBW weights from <em>optweight</em> did.
However, in the second table, we can see big differences in the KS
statistics between the SBW weights that incorporated the base weights
and those that didn’t. The KS statistics for the SBW weights that
incorporated the base weights (listed in the <code>KS.ow_bw</code>
column) are very close to those for the GBM weights (listed in the
<code>KS.weightit</code> column) because the estimated weights are very
close to the GBM weights. In contrast, the SBW weights that didn’t
incorporate the base weights have very high KS statistics for some
covariates (listed in the <code>KS.ow</code> column); they are unable to
take advantage of the distribution-balancing properties of the original
GBM weights.</p>
<p>In this way, incorporating the base weights provides a middle ground
between the GBM weights and the basic SBW weights: they ensure exact
balance on the means while attempting to retain as much similarity to
the GBM weights as possible, thereby inheriting some of their balancing
properties. Unfortunately, one of those properties is also a very low
ESS, though in this case, little ESS is lost by enforcing the additional
balance constraints. Using different norms with base weights can also be
more effective than using with them uniform base weights, as different
norms prioritize similarity to the base weights in ways that may retain
different properties<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;Note that base weights do not affect the estimated
weights when using &lt;code&gt;norm = "log"&lt;/code&gt;.&lt;/p&gt;'><sup>3</sup></a>.</p>
</div>
</div>
<div class="section level3">
<h3 id="dual-variables">Dual variables<a class="anchor" aria-label="anchor" href="#dual-variables"></a>
</h3>
<p>Dual variables, also known as “shadow prices”, are part of the output
of the optimization problem that represent how “active” a given
constraint is at the optimum <span class="citation">(<a href="#ref-zubizarretaStableWeightsThat2015">Zubizarreta
2015</a>)</span>. A large dual variable means that relaxing the
constraint will allow the objective function to reach a lower value.
They are related to the coefficients on covariates in a propensity score
model, representing how much each covariate is contributing to the
estimation of the weights.</p>
<p><span class="citation">Zubizarreta (<a href="#ref-zubizarretaStableWeightsThat2015">2015</a>)</span> describes
the utility of dual variables after SBW: they can be used to determine
which covariates have constraints that can be relaxed to improve
precision and which covariates have constraints that can be tightened
without affecting precision. The dual variables are available in
<code><a href="../reference/optweight.html">optweight()</a></code> output in the <code>duals</code> component, but
they can also be plotted using <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>. They can also be
useful for diagnosing convergence failure; often, a constraint that is
impossible to meet will have a high dual variable when no solution can
be found.</p>
<p>Below, we’ll demonstrate how we can use the dual variables to see how
to modify constraints to try to take advantage of the bias-variance
trade-off. First we’ll estimate SBW weights with balance tolerances of
.02 for all covariates.</p>
<div class="sourceCode" id="cb50"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_tols.html">process_tols</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                       <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                     data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                     tols <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                tols <span class="op">=</span> <span class="va">tols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow</span>, weight.range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            L2    L1    L∞ Rel Ent # Zeros</span></span>
<span><span class="co">## treated 0.    0.    0.      0.          0</span></span>
<span><span class="co">## control 1.616 1.267 4.212   1.118       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unweighted   429.      185</span></span>
<span><span class="co">## Weighted     118.8     185</span></span></code></pre>
<p>We can print the dual variables in the <code>duals</code> component
of the output object and plot them with <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb52"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow</span><span class="op">$</span><span class="va">duals</span></span></code></pre></div>
<pre><code><span><span class="co">##   component   constraint      cov    dual</span></span>
<span><span class="co">## 1         0 weight range     &lt;NA&gt; 2.46151</span></span>
<span><span class="co">## 2         1      balance      age 0.24485</span></span>
<span><span class="co">## 3         1      balance     educ 0.62674</span></span>
<span><span class="co">## 4         1      balance     race 5.66548</span></span>
<span><span class="co">## 5         1      balance  married 1.05266</span></span>
<span><span class="co">## 6         1      balance nodegree 1.61135</span></span>
<span><span class="co">## 7         1      balance     re74 0.71501</span></span>
<span><span class="co">## 8         1      balance     re75 0.04373</span></span></code></pre>
<div class="sourceCode" id="cb54"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ow</span><span class="op">)</span></span></code></pre></div>
<p><img src="optweight_files/figure-html/unnamed-chunk-28-1.png" class="r-plt" alt="" width="576"></p>
<p>From this, it’s clear that <code>race</code> has the largest dual
variable, and <code>re75</code> has the smallest. That means we can
likely get the biggest gains in ESS by relaxing the balance constraint
for <code>race</code>, whereas tightening the balance constraint for
<code>re75</code> will have little effect on the ESS. Below, we relax
the balance constraint for <code>race</code> to .1.</p>
<div class="sourceCode" id="cb55"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span><span class="op">[</span><span class="st">"race"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.1</span></span>
<span></span>
<span><span class="va">ow2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                 tols <span class="op">=</span> <span class="va">tols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow2</span>, weight.range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            L2    L1    L∞ Rel Ent # Zeros</span></span>
<span><span class="co">## treated 0.    0.    0.       0.         0</span></span>
<span><span class="co">## control 1.424 1.113 3.638    0.91       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unweighted   429.      185</span></span>
<span><span class="co">## Weighted     141.7     185</span></span></code></pre>
<p>By relaxing the constraint on <code>race</code>, our ESS increased by
quite a bit. We would not see the same increase had we instead relaxed
the constraint on a covariate with a smaller dual variable, like
<code>re75</code>. Below, we restore all balance constraints to .02 and
then set the balance constraint for <code>re75</code> to .1.</p>
<div class="sourceCode" id="cb57"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span><span class="op">[</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.02</span></span>
<span><span class="va">tols</span><span class="op">[</span><span class="st">"re75"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.1</span></span>
<span></span>
<span><span class="va">ow3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                 tols <span class="op">=</span> <span class="va">tols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow3</span>, weight.range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            L2    L1    L∞ Rel Ent # Zeros</span></span>
<span><span class="co">## treated 0.    0.    0.      0.          0</span></span>
<span><span class="co">## control 1.616 1.267 4.207   1.118       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unweighted   429.      185</span></span>
<span><span class="co">## Weighted     118.8     185</span></span></code></pre>
<p>This had virtually no effect on the ESS (relative to all balance
tolerances being equal to .02). However, this also suggests we can
tighten the constraint on <code>re75</code> without much loss in ESS.
Below, we decrease the tolerance on <code>re75</code> to 0:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span><span class="op">[</span><span class="st">"re75"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">0</span></span>
<span></span>
<span><span class="va">ow4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                 tols <span class="op">=</span> <span class="va">tols</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow4</span>, weight.range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            L2    L1    L∞ Rel Ent # Zeros</span></span>
<span><span class="co">## treated 0.    0.    0.       0.         0</span></span>
<span><span class="co">## control 1.617 1.269 4.229    1.12       0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##            Control Treated</span></span>
<span><span class="co">## Unweighted   429.      185</span></span>
<span><span class="co">## Weighted     118.7     185</span></span></code></pre>
<p>We see that despite the tighter tolerance, the ESS remains about the
same. For reference, below are the balance statistics and ESSs for all
four sets of weights:</p>
<div class="sourceCode" id="cb61"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/bal.tab.html" class="external-link">bal.tab</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ow  <span class="op">=</span> <span class="va">ow</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>                               ow2 <span class="op">=</span> <span class="va">ow2</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>                               ow3 <span class="op">=</span> <span class="va">ow3</span><span class="op">$</span><span class="va">weights</span>,</span>
<span>                               ow4 <span class="op">=</span> <span class="va">ow4</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## <span style="text-decoration: underline;">Balance Measures</span></span></span>
<span><span class="co">##                Type Diff.ow Diff.ow2 Diff.ow3 Diff.ow4</span></span>
<span><span class="co">## age         Contin.    0.02     0.02    0.020     0.02</span></span>
<span><span class="co">## educ        Contin.    0.02     0.02    0.020     0.02</span></span>
<span><span class="co">## race_black   Binary    0.02     0.10    0.020     0.02</span></span>
<span><span class="co">## race_hispan  Binary    0.00     0.00    0.000     0.00</span></span>
<span><span class="co">## race_white   Binary   -0.02    -0.10   -0.020    -0.02</span></span>
<span><span class="co">## married      Binary   -0.02    -0.02   -0.020    -0.02</span></span>
<span><span class="co">## nodegree     Binary    0.02     0.02    0.020     0.02</span></span>
<span><span class="co">## re74        Contin.   -0.02    -0.02   -0.020    -0.02</span></span>
<span><span class="co">## re75        Contin.    0.02     0.02    0.026    -0.00</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## <span style="text-decoration: underline;">Effective sample sizes</span></span></span>
<span><span class="co">##     Control Treated</span></span>
<span><span class="co">## All   429.      185</span></span>
<span><span class="co">## ow    118.8     185</span></span>
<span><span class="co">## ow2   141.7     185</span></span>
<span><span class="co">## ow3   118.8     185</span></span>
<span><span class="co">## ow4   118.7     185</span></span></code></pre>
<p>Again we can see that relaxing the balance constraint for
<code>race</code> increases the ESS significantly, whereas either
tightening or relaxing the constraint for <code>re75</code> has little
effect on the ESS.</p>
<p>Group balance constraints are not the only constraints that can be
relaxed; when an estimand other than the ATT is targeted, we also have
target balance constraints, and the constraint on the minimum of the
weights may be active as well (i.e., indicating that requiring the
weights to be positive limits the precision of the resulting weights).
Below, we demonstrate how these might differ by targeting the ATE:</p>
<div class="sourceCode" id="cb63"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                   <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                 data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                 estimand <span class="op">=</span> <span class="st">"ATE"</span><span class="op">)</span></span></code></pre></div>
<p>Plotting the dual variables reveals separate dual variables for the
target and balance constraints:</p>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ow</span><span class="op">)</span></span></code></pre></div>
<p><img src="optweight_files/figure-html/unnamed-chunk-34-1.png" class="r-plt" alt="" width="576"></p>
<p>The group and target balance constraints can be modified
independently of each other using <code>tols</code> and
<code>target.tols</code>, respectively. In this case, if we believed
<code>race</code> was a strong confounder but a weak effect modifier, we
may be more willing to relax its target balance constraints over its
group balance constraint.</p>
<p>We can also plot the sum of the dual variables for each type of
constraint to examine which set is most active by setting
<code>type = "constraints"</code> in <code><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot()</a></code>:</p>
<div class="sourceCode" id="cb65"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ow</span>, type <span class="op">=</span> <span class="st">"constraints"</span><span class="op">)</span></span></code></pre></div>
<p><img src="optweight_files/figure-html/unnamed-chunk-35-1.png" class="r-plt" alt="" width="576"></p>
<p>From this we can see that group balance and target constraints have
similar limiting effects on the optimization, whereas the weight range
(controlled by <code>min_w</code>) has little effect in this
example.</p>
</div>
<div class="section level3">
<h3 id="multivariate-treatments">Multivariate treatments<a class="anchor" aria-label="anchor" href="#multivariate-treatments"></a>
</h3>
<p>It is possible to supply balance constraints for multiple (i.e.,
multivariate) treatments simultaneously to estimate a single set of
weights that satisfies them all. This approach is described by <span class="citation">Chen and Zhou (<a href="#ref-chenCausalEffectEstimation2023">2023</a>)</span> in the
context of multiple continuous treatments. <code><a href="../reference/optweightMV.html">optweightMV()</a></code>
provides an interface to balancing multiple treatments and works
similarly to <code><a href="../reference/optweight.html">optweight()</a></code>, though with the ability to supply
multiple balancing formulas. Though this can be used with conceptually
distinct treatments, it can also sometimes be useful to use it with
multiple transformations of a single treatment; for example, <span class="citation">Greifer (<a href="#ref-greiferEstimatingBalancingWeights2020">2020</a>)</span> found
that in order to eliminate the bias due to certain kinds of imbalance
with a continuous treatment, the square of the centered treatment must
be uncorrelated with the covariates, in addition to the treatment itself
being uncorrelated with the covariates.</p>
<p>To use <code><a href="../reference/optweightMV.html">optweightMV()</a></code>, supply a list of balancing
formulas to the <code>formula.list</code> argument. The
<code>tols.list</code> argument must also be a list with a vector of
tolerances for each treatment, each with a value for each covariate.
However, <code>targets</code> should be a vector with a value for each
unique covariate since one cannot specify multiple targets for the same
covariate. Below is example (not run) of how to specify a call to
<code><a href="../reference/optweightMV.html">optweightMV()</a></code>:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">owmv</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweightMV.html">optweightMV</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">t1</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>,</span>
<span>                         <span class="va">t2</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span>,</span>
<span>                         <span class="va">t3</span> <span class="op">~</span> <span class="va">x1</span> <span class="op">+</span> <span class="va">x2</span> <span class="op">+</span> <span class="va">x3</span><span class="op">)</span>,</span>
<span>                    data <span class="op">=</span> <span class="va">data</span>,</span>
<span>                    tols.list <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">.01</span>, x2 <span class="op">=</span> <span class="fl">.01</span>, x3 <span class="op">=</span> <span class="fl">.01</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">.02</span>, x2 <span class="op">=</span> <span class="fl">.02</span>, x3 <span class="op">=</span> <span class="fl">.02</span><span class="op">)</span>,</span>
<span>                                     <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">.03</span>, x2 <span class="op">=</span> <span class="fl">.03</span>, x3 <span class="op">=</span> <span class="fl">.03</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                    targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>x1 <span class="op">=</span> <span class="fl">10</span>, x2 <span class="op">=</span> <span class="fl">.34</span>, x3 <span class="op">=</span> <span class="fl">5.5</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p>The syntax can be abbreviated by supplying a single value in each
element of <code>tols.list</code> that is applied to all covariates,
e.g., <code>tols.list = list(.01, .02, .03)</code>; or, if the same
vector of balance tolerance is desired for all covariates for all
treatments, a list with a single vector, e.g.,
<code>tols.list = list(c(x1 = .01, x2 = .01, x3 = .01))</code>; or, if
the same tolerance is desired for all covariates and all treatments, a
list with a single value, e.g., <code>tols.list = list(.02)</code>.
<code>targets</code> can be omitted to target the ATE (i.e., to balance
the covariates at their means in the sample), but no other estimands can
be specified.</p>
<p>One might be tempted to use <code><a href="../reference/optweightMV.html">optweightMV()</a></code> to estimate
balancing weights for longitudinal treatments. While this is possible,
it’s not as simple as supplying a balancing formula for each treatment
balancing the treatment and covariate history to that treatment <span class="citation">(<a href="#ref-yiuJointCalibratedEstimation2020">Yiu
and Su 2020</a>)</span>. <span class="citation">Zhou and Wodtke (<a href="#ref-zhouResidualBalancingMethod2020">2020</a>)</span> describe
how to specify balance constraints for entropy balancing with
longitudinal treatments, and they involve balancing not the covariate
directly but rather the residuals in regressions of the covariates on
treatment and covariate histories. Functionality for this specific
method is not present in <em>optweight</em>, but is available in the <a href="https://cran.r-project.org/package=rbw" class="external-link"><em>rbw</em></a> package.
It may be possible to implement this in <em>optweight</em> manually, but
I cannot advise on how to do so.</p>
</div>
<div class="section level3">
<h3 id="optweight-svy">
<code>optweight.svy()</code><a class="anchor" aria-label="anchor" href="#optweight-svy"></a>
</h3>
<p>When the goal is not to balance treatment groups to each other or to
some target population but rather to balance one sample to a target
distribution, one can use <code><a href="../reference/optweight.svy.html">optweight.svy()</a></code> instead of
<code><a href="../reference/optweight.html">optweight()</a></code>. The <code>.svy</code> suffix is an indication
that can be used as a method to generate survey weights so that the
sample generalizes to a population of interest with specific means.
<code><a href="../reference/optweight.svy.html">optweight.svy()</a></code> works just like <code><a href="../reference/optweight.html">optweight()</a></code>
except that no treatment variable is specified and <code>targets</code>
should be specified.</p>
<p>This is useful in the context of matching-adjusted indirect
comparison <span class="citation">(MAIC, <a href="#ref-signorovitchComparativeEffectivenessHeadtoHead2010">Signorovitch
et al. 2010</a>)</span>, which involves weighting a given trial sample
to resemble the covariate distribution of some other trial’s sample.
MAIC as originally described is equivalent to entropy balancing <span class="citation">(<a href="#ref-phillippoEquivalenceEntropyBalancing2020">Phillippo et al.
2020</a>)</span>, which can be requested by setting
<code>norm = "entropy"</code>.</p>
<p>Below, we demonstrate weighting the control subset of
<code>lalonde</code> to resemble a specific target population. As with
<code>optweightit()</code>, it can be helpful to use
<code><a href="../reference/process_targets.html">process_targets()</a></code> to simplify specification of the
covariates means. If all variables in the dataset are to be specified,
the formula can be omitted (for both <code><a href="../reference/process_targets.html">process_targets()</a></code> and
<code><a href="../reference/optweight.svy.html">optweight.svy()</a></code>).</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">lalonde_c</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">lalonde</span>, <span class="va">treat</span> <span class="op">==</span> <span class="fl">0</span>,</span>
<span>                    select <span class="op">=</span> <span class="op">-</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">treat</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">targets</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_targets.html">process_targets</a></span><span class="op">(</span><span class="va">lalonde_c</span><span class="op">)</span></span>
<span></span>
<span><span class="va">targets</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">targets</span>:</span></span>
<span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##     28.0303     10.2354      0.2028      0.1422      0.6550      0.5128 </span></span>
<span><span class="co">##    nodegree        re74        re75        re78 </span></span>
<span><span class="co">##      0.5967   5619.2365   2466.4844   6984.1697</span></span></code></pre>
<p>To request individual means, the targets can be set to those values.
To allow a covariate mean to vary freely, one can either omit it from
the calls to <code><a href="../reference/process_targets.html">process_targets()</a></code> and
<code><a href="../reference/optweight.svy.html">optweight.svy()</a></code> or set the target value to <code>NA</code>.
We’ll do that for <code>re78</code>, and set specific targets for the
other variables except <code>re75</code>, which we’ll leave at its
mean.</p>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">targets</span><span class="op">[</span><span class="st">"age"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">40</span></span>
<span><span class="va">targets</span><span class="op">[</span><span class="st">"educ"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">9</span></span>
<span><span class="va">targets</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"race_black"</span>, <span class="st">"race_hispan"</span>, <span class="st">"race_white"</span><span class="op">)</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">.2</span>, <span class="fl">.2</span>, <span class="fl">.6</span><span class="op">)</span></span>
<span><span class="va">targets</span><span class="op">[</span><span class="st">"married"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.6</span></span>
<span><span class="va">targets</span><span class="op">[</span><span class="st">"nodegree"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">.6</span></span>
<span><span class="va">targets</span><span class="op">[</span><span class="st">"re74"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">1000</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">targets</span><span class="op">[</span><span class="st">"re78"</span><span class="op">]</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">TRUE</span></span>
<span></span>
<span><span class="va">targets</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">targets</span>:</span></span>
<span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##        40.0         9.0         0.2         0.2         0.6         0.6 </span></span>
<span><span class="co">##    nodegree        re74        re75        re78 </span></span>
<span><span class="co">##         0.6      1000.0      2466.5          NA</span></span></code></pre>
<p>We can supply these to <code><a href="../reference/optweight.svy.html">optweight.svy()</a></code>. This time we’ll
set <code>min.w</code> to 0 to allow those with weights of 0 to be
effectively dropped from the sample.</p>
<div class="sourceCode" id="cb71"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.svy.html">optweight.svy</a></span><span class="op">(</span><span class="va">lalonde_c</span>,</span>
<span>                      targets <span class="op">=</span> <span class="va">targets</span>,</span>
<span>                      min.w <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ow_s</span></span></code></pre></div>
<pre><code><span><span class="co">## An <span style="font-style: italic;">optweight.svy</span> object</span></span>
<span><span class="co">##  - number of obs.: 429</span></span>
<span><span class="co">##  - norm minimized: "l2"</span></span>
<span><span class="co">##  - sampling weights: present</span></span>
<span><span class="co">##  - base weights: present</span></span>
<span><span class="co">##  - covariates: age, educ, race, married, nodegree, re74, re75, re78</span></span></code></pre>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow_s</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight ranges</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##     Min                                 Max</span></span>
<span><span class="co">## all   0 |---------------------------| 13.54</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Units with the 5 most extreme weights</span>:</span></span>
<span><span class="co">##                                      </span></span>
<span><span class="co">##        404   152    111     19     16</span></span>
<span><span class="co">##  all 9.488 9.669 11.326 11.429 13.537</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##        L2  L1    L∞ # Zeros</span></span>
<span><span class="co">## all 2.237 1.5 12.54     307</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Total</span></span>
<span><span class="co">## Unweighted 429.  </span></span>
<span><span class="co">## Weighted    71.44</span></span></code></pre>
<p>We can see that the weights required to move the sample toward our
specified target decrease the ESS by quite a bit, and several units were
given weights of 0. This can actually be a good thing if it means less
data needs to be collected since those with weights of 0 are not
necessary for subsequent analysis. We can examine the weighted covariate
means using <code>cobalt::col_w_means()</code> as before, with the
estimated weights supplied to <code>s.weights</code>:</p>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">col_w_mean</a></span><span class="op">(</span><span class="va">lalonde_c</span>, s.weights <span class="op">=</span> <span class="va">ow_s</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##        40.0         9.0         0.2         0.2         0.6         0.6 </span></span>
<span><span class="co">##    nodegree        re74        re75        re78 </span></span>
<span><span class="co">##         0.6      1000.0      2466.5      4725.6</span></span></code></pre>
<p>We can see that the weighted mean of <code>re78</code> is whatever
minimized the <span class="math inline">\(L_2\)</span> norm of the
weights since no constraint was placed on it. As with
<code><a href="../reference/optweight.html">optweight()</a></code>, we can see how much each constraint
contributed to the increase in variability by examining the dual
variables:</p>
<div class="sourceCode" id="cb77"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">ow_s</span><span class="op">)</span></span></code></pre></div>
<p><img src="optweight_files/figure-html/unnamed-chunk-41-1.png" class="r-plt" alt="" width="576"></p>
<p>Here it’s clear that the constraint on <code>re74</code> is
contributing the most, and that relaxing the constraint would have the
greatest impact on ESS. The constraint can be relaxed either by changing
the target to one closer to that of the original data (or closer to
where it would be if no constraint was placed on <code>re74</code>) or
by setting a more relaxed tolerance for <code>re74</code> using
<code>tols</code>. We’ll use the latter option below:</p>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">tols</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/process_tols.html">process_tols</a></span><span class="op">(</span><span class="va">lalonde_c</span>, tols <span class="op">=</span> <span class="fl">0</span><span class="op">)</span></span>
<span></span>
<span><span class="va">tols</span><span class="op">[</span><span class="st">"re74"</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fl">300</span></span>
<span></span>
<span><span class="va">tols</span></span></code></pre></div>
<pre><code><span><span class="co">##  - <span style="font-style: italic;">tols</span>:</span></span>
<span><span class="co">##      age     educ     race  married nodegree     re74     re75     re78 </span></span>
<span><span class="co">##        0        0        0        0        0      300        0        0</span></span></code></pre>
<p>Here we set the tolerance for <code>re74</code> to be 300. We need to
set <code>std.cont = FALSE</code> to tell <code><a href="../reference/optweight.svy.html">optweight.svy()</a></code>
that the tolerance for continuous variables should be in raw units, not
standardized units. Now we can interpret our constraint as allowing the
weighted mean for <code>re74</code> to be within 300 of its specified
target of 1000.</p>
<div class="sourceCode" id="cb80"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow_s2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.svy.html">optweight.svy</a></span><span class="op">(</span><span class="va">lalonde_c</span>,</span>
<span>                       targets <span class="op">=</span> <span class="va">targets</span>,</span>
<span>                       min.w <span class="op">=</span> <span class="fl">0</span>,</span>
<span>                       tols <span class="op">=</span> <span class="va">tols</span>,</span>
<span>                       std.cont <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">ow_s2</span>, weight.range <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##                   <span style="text-decoration: underline;">Summary of weights</span></span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Weight statistics</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##       L2   L1    L∞ # Zeros</span></span>
<span><span class="co">## all 2.07 1.44 10.68     290</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## - <span style="font-style: italic;">Effective Sample Sizes</span>:</span></span>
<span><span class="co">## </span></span>
<span><span class="co">##             Total</span></span>
<span><span class="co">## Unweighted 429.  </span></span>
<span><span class="co">## Weighted    81.15</span></span></code></pre>
<p>This increased the ESS of the weights, and below we can see that the
weighted mean for <code>re74</code> is at most 300 away from 1000, while
the other variables are at their specified targets.</p>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">cobalt</span><span class="fu">::</span><span class="fu"><a href="https://ngreifer.github.io/cobalt/reference/balance-summary.html" class="external-link">col_w_mean</a></span><span class="op">(</span><span class="va">lalonde_c</span>, s.weights <span class="op">=</span> <span class="va">ow_s2</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##         age        educ  race_black race_hispan  race_white     married </span></span>
<span><span class="co">##        40.0         9.0         0.2         0.2         0.6         0.6 </span></span>
<span><span class="co">##    nodegree        re74        re75        re78 </span></span>
<span><span class="co">##         0.6      1300.0      2466.5      4710.8</span></span></code></pre>
</div>
</div>
<div class="section level2">
<h2 id="est-effects">Estimating effects<a class="anchor" aria-label="anchor" href="#est-effects"></a>
</h2>
<p>Because SBW weights function just like IPW weights, the same
procedures can be used to estimate the effect of treatment in an
SBW-weighted sample. One only needs to run a regression of the outcome
on the treatment with the weights incorporated. It is critical that the
usual standard errors from <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> or <code><a href="https://rdrr.io/r/stats/glm.html" class="external-link">glm()</a></code>,
etc., are not used; special standard errors are required after
weighting. See
<code><a href="https://ngreifer.github.io/WeightIt/articles/estimating-effects.html" class="external-link">vignette("estimating-effects", package = "WeightIt")</a></code> for
more details on estimating effects after weighting. <em>WeightIt</em>
provides tools for facilitating this when weights are estimated using
<code><a href="https://ngreifer.github.io/WeightIt/reference/weightit.html" class="external-link">WeightIt::weightit()</a></code>, which provides an interface to
<code><a href="../reference/optweight.html">optweight()</a></code>, though with slightly fewer options
available.</p>
<p>Often, the best way to account for uncertainty in estimating a
treatment effect after SBW is by bootstrapping. This ensures variability
due to estimating the weights is correctly incorporated. The fractional
weighted bootstrap <span class="citation">(<a href="#ref-xuApplicationsFractionalRandomWeightBootstrap2020a">Xu et al.
2020</a>)</span> is often particularly effective because no units are
dropped from the sample in each bootstrap replication. When
bootstrapping cannot be used (e.g., because it is too computationally
demanding or the specified constraints cannot be expected to be
satisfied in all bootstrap samples), using a robust standard error can
be an acceptable alternative.</p>
<p>Below, we demonstrate both approaches with the <code>lalonde</code>
data. First, we estimate the weights for the ATT and fit the outcome
model.</p>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ow</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/optweight.html">optweight</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">~</span> <span class="va">age</span> <span class="op">+</span> <span class="va">educ</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">married</span> <span class="op">+</span></span>
<span>                  <span class="va">nodegree</span> <span class="op">+</span> <span class="va">re74</span> <span class="op">+</span> <span class="va">re75</span>,</span>
<span>                data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>                estimand <span class="op">=</span> <span class="st">"ATT"</span>,</span>
<span>                eps <span class="op">=</span> <span class="fl">1e-5</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm</a></span><span class="op">(</span><span class="va">re78</span> <span class="op">~</span> <span class="va">treat</span>, data <span class="op">=</span> <span class="va">lalonde</span>,</span>
<span>          weights <span class="op">=</span> <span class="va">ow</span><span class="op">$</span><span class="va">weights</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## (Intercept)       treat </span></span>
<span><span class="co">##        5145        1204</span></span></code></pre>
<p>Again, we must not use the usual standard errors produced by running
<code><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary()</a></code> on the <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> output; we must use
either bootstrapping or a robust standard error. First, we’ll use
bootstrapping with <a href="https://ngreifer.github.io/fwb/" class="external-link"><em>fwb</em></a>, which
implements the fractional weighted bootstrap. This involves drawing a
set of weights from a distribution and performing the entire analysis
with these weights incorporated. These weights should be supplied to the
<code>s.weights</code> argument in <code><a href="../reference/optweight.html">optweight()</a></code> and
multiplied by the returned weights before being used in
<code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;When sampling weights are used with
&lt;code&gt;&lt;a href="../reference/optweight.html"&gt;optweight()&lt;/a&gt;&lt;/code&gt;, they should first be multiplied by the
bootstrap weights.&lt;/p&gt;'><sup>4</sup></a>. We can use <code><a href="https://rdrr.io/r/stats/update.html" class="external-link">update()</a></code> to
re-estimate the SBW weights and weighted regression model in each
bootstrap replication.</p>
<div class="sourceCode" id="cb86"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ngreifer.github.io/fwb/" class="external-link">fwb</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">bootfun</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="va">data</span>, <span class="va">w</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="va">ow_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">ow</span>, s.weights <span class="op">=</span> <span class="va">w</span><span class="op">)</span></span>
<span>  <span class="va">fit_boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/update.html" class="external-link">update</a></span><span class="op">(</span><span class="va">fit</span>, weights <span class="op">=</span> <span class="va">ow_boot</span><span class="op">$</span><span class="va">weights</span> <span class="op">*</span> <span class="va">w</span><span class="op">)</span></span>
<span>  </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/stats/coef.html" class="external-link">coef</a></span><span class="op">(</span><span class="va">fit_boot</span><span class="op">)</span></span>
<span><span class="op">}</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span></span>
<span></span>
<span><span class="va">boot</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ngreifer.github.io/fwb/reference/fwb.html" class="external-link">fwb</a></span><span class="op">(</span><span class="va">lalonde</span>, <span class="va">bootfun</span>,</span>
<span>            R <span class="op">=</span> <span class="fl">500</span>, <span class="co"># more is always better, but slower</span></span>
<span>            verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">boot</span>, ci.type <span class="op">=</span> <span class="st">"wald"</span>, p.value <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             Estimate Std. Error CI 2.5 % CI 97.5 % z value Pr(&gt;|z|)    </span></span>
<span><span class="co">## (Intercept)     5145        571     4026      6263    9.02   &lt;2e-16 ***</span></span>
<span><span class="co">## treat           1204        754     -274      2682    1.60     0.11    </span></span>
<span><span class="co">## ---</span></span>
<span><span class="co">## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</span></span></code></pre>
<p>To use a robust standard error, it’s easiest to use functions in the
<a href="https://marginaleffects.com/" class="external-link"><em>marginaleffects</em></a>
package. Supply the output of <code><a href="https://rdrr.io/r/stats/lm.html" class="external-link">lm()</a></code> to
<code><a href="https://marginaleffects.com/man/r/comparisons.html" class="external-link">marginaleffects::avg_comparisons()</a></code> with
<code>vcov = "HC3"</code> to request a robust standard error for the
treatment effect estimate.</p>
<div class="sourceCode" id="cb88"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://marginaleffects.com/" class="external-link">marginaleffects</a></span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://marginaleffects.com/man/r/comparisons.html" class="external-link">avg_comparisons</a></span><span class="op">(</span><span class="va">fit</span>,</span>
<span>                variables <span class="op">=</span> <span class="st">"treat"</span>,</span>
<span>                vcov <span class="op">=</span> <span class="st">"HC3"</span>,</span>
<span>                newdata <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">treat</span> <span class="op">==</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## </span></span>
<span><span class="co">##  Estimate Std. Error    z Pr(&gt;|z|)   S 2.5 % 97.5 %</span></span>
<span><span class="co">##      1204        824 1.46    0.144 2.8  -411   2819</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Term: treat</span></span>
<span><span class="co">## Type: response</span></span>
<span><span class="co">## Comparison: 1 - 0</span></span></code></pre>
<p>Robust standard errors treat the weights as fixed, which often yields
larger standard errors than the bootstrap.</p>
</div>
<div class="section level2">
<h2 id="further-reading">Further reading<a class="anchor" aria-label="anchor" href="#further-reading"></a>
</h2>
<p>The methods implemented here have been described in several papers.
Below is a selected annotated reading list for more information on the
weights and their uses, properties, and extensions.</p>
<ul>
<li><p>The canonical reference for SBW is <span class="citation">Zubizarreta (<a href="#ref-zubizarretaStableWeightsThat2015">2015</a>)</span>, which
introduces them.</p></li>
<li><p>The general theory of weighting for balance is described for
applied audiences by <span class="citation">Chattopadhyay, Hase, and
Zubizarreta (<a href="#ref-chattopadhyayBalancingVsModeling2020">2020</a>)</span> and
<span class="citation">Cohn and Zubizarreta (<a href="#ref-cohnWeightingCausalInference2025">2025</a>)</span>.</p></li>
<li><p>A complete theoretical perspective on SBW is offered by <span class="citation">Y. Wang and Zubizarreta (<a href="#ref-wangMinimalDispersionApproximately2020">2020</a>)</span>.
Note their results primarily extend to cases where the constraint on the
nonnegativity of the weights is removed.</p></li>
<li><p><span class="citation">Chan, Yam, and Zhang (<a href="#ref-chanGloballyEfficientNonparametric2016">2016</a>)</span>
describe a general framework that includes SBW, with a focus on exact
balance. The specific method they describe is equivalent to entropy
balancing (i.e., using <code>norm = "entropy"</code>).</p></li>
<li><p>Entropy balancing in general is described by <span class="citation">Hainmueller (<a href="#ref-hainmuellerEntropyBalancingCausal2012">2012</a>)</span> and
expanded on by <span class="citation">Zhao and Percival (<a href="#ref-zhaoEntropyBalancingDoubly2017">2017</a>)</span> and <span class="citation">Källberg and Waernbaum (<a href="#ref-kallbergLargeSampleProperties2023">2023</a>)</span>.</p></li>
<li><p>SBW for multi-category treatments is described by <span class="citation">de los Angeles Resa and Zubizarreta (<a href="#ref-delosangelesresaDirectStableWeight2020">2020</a>)</span>. SBW
for continuous treatments is described by <span class="citation">Greifer
(<a href="#ref-greiferEstimatingBalancingWeights2020">2020</a>)</span>.
Related theory for continuous treatments in the context of entropy
balancing is described by <span class="citation">Tübbicke (<a href="#ref-tubbickeEntropyBalancingContinuous2022">2022</a>)</span> and
<span class="citation">Vegetabile et al. (<a href="#ref-vegetabileNonparametricEstimationPopulation2021">2021</a>)</span>.</p></li>
<li><p>SBW for generalizing a single sample to a target population
(i.e., as implemented in <code><a href="../reference/optweight.svy.html">optweight.svy()</a></code>), also known as
matching-adjusted indirect comparison (MAIC), is described in <span class="citation">Jackson, Rhodes, and Ouwens (<a href="#ref-jacksonAlternativeWeightingSchemes2021">2021</a>)</span>. The
general theory of MAIC is developed in <span class="citation">Signorovitch et al. (<a href="#ref-signorovitchComparativeEffectivenessHeadtoHead2010">2010</a>)</span>
and reviewed in <span class="citation">Jiang et al. (<a href="#ref-jiangComprehensiveReviewShiny2024">2024</a>)</span>. <span class="citation">J. Wang (<a href="#ref-wangMatchingadjustedIndirectComparison2021">2021</a>)</span>
also discusses MAIC, including the performance of different
<code>norm</code> choices.</p></li>
<li><p>SBW for simultaneously balancing and generalizing to a target
population is described by <span class="citation">Chattopadhyay, Cohn,
and Zubizarreta (<a href="#ref-chattopadhyayOneStepWeightingGeneralize2024">2024</a>)</span>.</p></li>
<li><p>The connections between SBW and g-computation for estimating
treatments effects are described by <span class="citation">Chattopadhyay
and Zubizarreta (<a href="#ref-chattopadhyayImpliedWeightsLinear2023">2023</a>)</span>,
<span class="citation">Chattopadhyay, Greifer, and Zubizarreta (<a href="#ref-chattopadhyayLmwLinearModel2024">2024</a>)</span>, and <span class="citation">Chattopadhyay and Zubizarreta (<a href="#ref-chattopadhyayCausationComparisonRegression2024">2024</a>)</span>.</p></li>
</ul>
</div>
<div class="section level2">
<h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-barnardPartiallyRetargetedBalancing2025" class="csl-entry">
Barnard, Martha, Jared D. Huling, and Julian Wolfson. 2025.
<span>“Partially Retargeted Balancing Weights for Causal Effect
Estimation Under Positivity Violations.”</span> <a href="https://doi.org/10.48550/arXiv.2510.22072" class="external-link">https://doi.org/10.48550/arXiv.2510.22072</a>.
</div>
<div id="ref-chanGloballyEfficientNonparametric2016" class="csl-entry">
Chan, Kwun Chuen Gary, Sheung Chi Phillip Yam, and Zheng Zhang. 2016.
<span>“Globally Efficient Non-Parametric Inference of Average Treatment
Effects by Empirical Balancing Calibration Weighting.”</span>
<em>Journal of the Royal Statistical Society: Series B (Statistical
Methodology)</em> 78 (3): 673–700. <a href="https://doi.org/10.1111/rssb.12129" class="external-link">https://doi.org/10.1111/rssb.12129</a>.
</div>
<div id="ref-chattopadhyayOneStepWeightingGeneralize2024" class="csl-entry">
Chattopadhyay, Ambarish, Eric R. Cohn, and José R. Zubizarreta. 2024.
<span>“One-Step Weighting to Generalize and Transport Treatment Effect
Estimates to a Target Population.”</span> <em>The American
Statistician</em> 78 (3): 280–89. <a href="https://doi.org/10.1080/00031305.2023.2267598" class="external-link">https://doi.org/10.1080/00031305.2023.2267598</a>.
</div>
<div id="ref-chattopadhyayLmwLinearModel2024" class="csl-entry">
Chattopadhyay, Ambarish, Noah Greifer, and José R. Zubizarreta. 2024.
<span>“Lmw: Linear Model Weights for Causal Inference.”</span>
<em>Observational Studies</em> 10 (2): 33–62. <a href="https://doi.org/10.1353/obs.2024.a946582" class="external-link">https://doi.org/10.1353/obs.2024.a946582</a>.
</div>
<div id="ref-chattopadhyayBalancingVsModeling2020" class="csl-entry">
Chattopadhyay, Ambarish, Christopher H. Hase, and José R. Zubizarreta.
2020. <span>“Balancing Vs Modeling Approaches to Weighting in
Practice.”</span> <em>Statistics in Medicine</em> 39 (24): 3227–54. <a href="https://doi.org/10.1002/sim.8659" class="external-link">https://doi.org/10.1002/sim.8659</a>.
</div>
<div id="ref-chattopadhyayImpliedWeightsLinear2023" class="csl-entry">
Chattopadhyay, Ambarish, and José R Zubizarreta. 2023. <span>“On the
Implied Weights of Linear Regression for Causal Inference.”</span>
<em>Biometrika</em> 110 (3): 615–29. <a href="https://doi.org/10.1093/biomet/asac058" class="external-link">https://doi.org/10.1093/biomet/asac058</a>.
</div>
<div id="ref-chattopadhyayCausationComparisonRegression2024" class="csl-entry">
Chattopadhyay, Ambarish, and José R. Zubizarreta. 2024.
<span>“Causation, Comparison, and Regression.”</span> <em>Harvard Data
Science Review</em> 6 (1). <a href="https://doi.org/10.1162/99608f92.87c6125f" class="external-link">https://doi.org/10.1162/99608f92.87c6125f</a>.
</div>
<div id="ref-chenCausalEffectEstimation2023" class="csl-entry">
Chen, Juan, and Yingchun Zhou. 2023. <span>“Causal Effect Estimation for
Multivariate Continuous Treatments.”</span> <em>Biometrical Journal</em>
65 (5): 2200122. <a href="https://doi.org/10.1002/bimj.202200122" class="external-link">https://doi.org/10.1002/bimj.202200122</a>.
</div>
<div id="ref-cohnWeightingCausalInference2025" class="csl-entry">
Cohn, Eric R., and José R. Zubizarreta. 2025. <span>“Weighting for
Causal Inference in Mental Health Research.”</span> <em>International
Journal of Methods in Psychiatric Research</em> 34 (2): e70018. <a href="https://doi.org/10.1002/mpr.70018" class="external-link">https://doi.org/10.1002/mpr.70018</a>.
</div>
<div id="ref-delosangelesresaDirectStableWeight2020" class="csl-entry">
de los Angeles Resa, María, and José R. Zubizarreta. 2020. <span>“Direct
and Stable Weight Adjustment in Non-Experimental Studies With
Multivalued Treatments: Analysis of the Effect of an Earthquake on
Post-Traumatic Stress.”</span> <em>Journal of the Royal Statistical
Society Series A: Statistics in Society</em> 183 (4): 1387–1410. <a href="https://doi.org/10.1111/rssa.12561" class="external-link">https://doi.org/10.1111/rssa.12561</a>.
</div>
<div id="ref-dorieAutomatedDoityourselfMethods2019" class="csl-entry">
Dorie, Vincent, Jennifer Hill, Uri Shalit, Marc Scott, and Dan Cervone.
2019. <span>“Automated Versus Do-It-Yourself Methods for Causal
Inference: Lessons Learned from a Data Analysis Competition.”</span>
<em>Statistical Science</em> 34 (1): 43–68. <a href="https://doi.org/10.1214/18-STS667" class="external-link">https://doi.org/10.1214/18-STS667</a>.
</div>
<div id="ref-fongCovariateBalancingPropensity2018" class="csl-entry">
Fong, Christian, Chad Hazlett, and Kosuke Imai. 2018. <span>“Covariate
Balancing Propensity Score for a Continuous Treatment: Application to
the Efficacy of Political Advertisements.”</span> <em>The Annals of
Applied Statistics</em> 12 (1): 156–77. <a href="https://doi.org/10.1214/17-AOAS1101" class="external-link">https://doi.org/10.1214/17-AOAS1101</a>.
</div>
<div id="ref-greiferEstimatingBalancingWeights2020" class="csl-entry">
Greifer, Noah. 2020. <span>“Estimating Balancing Weights for Continuous
Treatments Using Constrained Optimization.”</span> PhD thesis. <a href="https://doi.org/10.17615/DYSS-B342" class="external-link">https://doi.org/10.17615/DYSS-B342</a>.
</div>
<div id="ref-hainmuellerEntropyBalancingCausal2012" class="csl-entry">
Hainmueller, J. 2012. <span>“Entropy Balancing for Causal Effects: A
Multivariate Reweighting Method to Produce Balanced Samples in
Observational Studies.”</span> <em>Political Analysis</em> 20 (1):
25–46. <a href="https://doi.org/10.1093/pan/mpr025" class="external-link">https://doi.org/10.1093/pan/mpr025</a>.
</div>
<div id="ref-jacksonAlternativeWeightingSchemes2021" class="csl-entry">
Jackson, Dan, Kirsty Rhodes, and Mario Ouwens. 2021. <span>“Alternative
Weighting Schemes When Performing Matching-Adjusted Indirect
Comparisons.”</span> <em>Research Synthesis Methods</em> 12 (3): 333–46.
<a href="https://doi.org/10.1002/jrsm.1466" class="external-link">https://doi.org/10.1002/jrsm.1466</a>.
</div>
<div id="ref-jiangComprehensiveReviewShiny2024" class="csl-entry">
Jiang, Ziren, Joseph C. Cappelleri, Margaret Gamalo, Yong Chen, Neal
Thomas, and Haitao Chu. 2024. <span>“A Comprehensive Review and Shiny
Application on the Matching<span>-</span>Adjusted Indirect
Comparison.”</span> <em>Research Synthesis Methods</em> 15 (4): 671–86.
<a href="https://doi.org/10.1002/jrsm.1709" class="external-link">https://doi.org/10.1002/jrsm.1709</a>.
</div>
<div id="ref-kallbergLargeSampleProperties2023" class="csl-entry">
Källberg, David, and Ingeborg Waernbaum. 2023. <span>“Large Sample
Properties of Entropy Balancing Estimators of Average Causal
Effects.”</span> <em>Econometrics and Statistics</em>, November. <a href="https://doi.org/10.1016/j.ecosta.2023.11.004" class="external-link">https://doi.org/10.1016/j.ecosta.2023.11.004</a>.
</div>
<div id="ref-kallusOptimalEstimationGeneralized2019" class="csl-entry">
Kallus, Nathan, and Michele Santacatterina. 2019. <span>“Optimal
Estimation of Generalized Average Treatment Effects Using Kernel Optimal
Matching.”</span> <em>arXiv:1908.04748 [Stat]</em>, August. <a href="http://arxiv.org/abs/1908.04748" class="external-link">http://arxiv.org/abs/1908.04748</a>.
</div>
<div id="ref-phillippoEquivalenceEntropyBalancing2020" class="csl-entry">
Phillippo, David M., Sofia Dias, A. E. Ades, and Nicky J. Welton. 2020.
<span>“Equivalence of Entropy Balancing and the Method of Moments for
Matching<span>-</span>Adjusted Indirect Comparison.”</span> <em>Research
Synthesis Methods</em> 11 (4): 568–72. <a href="https://doi.org/10.1002/jrsm.1416" class="external-link">https://doi.org/10.1002/jrsm.1416</a>.
</div>
<div id="ref-signorovitchComparativeEffectivenessHeadtoHead2010" class="csl-entry">
Signorovitch, James E., Eric Q. Wu, Andrew P. Yu, Charles M. Gerrits,
Evan Kantor, Yanjun Bao, Shiraz R. Gupta, and Parvez M. Mulani. 2010.
<span>“Comparative Effectiveness Without Head-to-Head Trials: A Method
for Matching-Adjusted Indirect Comparisons Applied to Psoriasis
Treatment with Adalimumab or Etanercept.”</span>
<em>PharmacoEconomics</em> 28 (10): 935–45. <a href="https://doi.org/10.2165/11538370-000000000-00000" class="external-link">https://doi.org/10.2165/11538370-000000000-00000</a>.
</div>
<div id="ref-tubbickeEntropyBalancingContinuous2022" class="csl-entry">
Tübbicke, Stefan. 2022. <span>“Entropy Balancing for Continuous
Treatments.”</span> <em>Journal of Econometric Methods</em> 11 (1):
71–89. <a href="https://doi.org/10.1515/jem-2021-0002" class="external-link">https://doi.org/10.1515/jem-2021-0002</a>.
</div>
<div id="ref-vegetabileNonparametricEstimationPopulation2021" class="csl-entry">
Vegetabile, Brian G., Beth Ann Griffin, Donna L. Coffman, Matthew
Cefalu, Michael W. Robbins, and Daniel F. McCaffrey. 2021.
<span>“Nonparametric Estimation of Population Average Dose-Response
Curves Using Entropy Balancing Weights for Continuous Exposures.”</span>
<em>Health Services and Outcomes Research Methodology</em> 21 (1):
69–110. <a href="https://doi.org/10.1007/s10742-020-00236-2" class="external-link">https://doi.org/10.1007/s10742-020-00236-2</a>.
</div>
<div id="ref-wangMatchingadjustedIndirectComparison2021" class="csl-entry">
Wang, Jixian. 2021. <span>“On Matching-Adjusted Indirect Comparison and
Calibration Estimation.”</span> <a href="https://arxiv.org/abs/2107.11687" class="external-link">https://arxiv.org/abs/2107.11687</a>.
</div>
<div id="ref-wangMinimalDispersionApproximately2020" class="csl-entry">
Wang, Yixin, and José R. Zubizarreta. 2020. <span>“Minimal Dispersion
Approximately Balancing Weights: Asymptotic Properties and Practical
Considerations.”</span> <em>Biometrika</em> 107 (1): 93–105. <a href="https://doi.org/10.1093/biomet/asz050" class="external-link">https://doi.org/10.1093/biomet/asz050</a>.
</div>
<div id="ref-xuApplicationsFractionalRandomWeightBootstrap2020a" class="csl-entry">
Xu, Li, Chris Gotwalt, Yili Hong, Caleb B. King, and William Q. Meeker.
2020. <span>“Applications of the Fractional-Random-Weight
Bootstrap.”</span> <em>The American Statistician</em> 74 (4): 345–58. <a href="https://doi.org/10.1080/00031305.2020.1731599" class="external-link">https://doi.org/10.1080/00031305.2020.1731599</a>.
</div>
<div id="ref-yiuJointCalibratedEstimation2020" class="csl-entry">
Yiu, Sean, and Li Su. 2020. <span>“Joint Calibrated Estimation of
Inverse Probability of Treatment and Censoring Weights for Marginal
Structural Models.”</span> <em>Biometrics</em> n/a (n/a).
https://doi.org/<a href="https://doi.org/10.1111/biom.13411" class="external-link">https://doi.org/10.1111/biom.13411</a>.
</div>
<div id="ref-zhaoEntropyBalancingDoubly2017" class="csl-entry">
Zhao, Qingyuan, and Daniel Percival. 2017. <span>“Entropy Balancing Is
Doubly Robust.”</span> <em>Journal of Causal Inference</em> 5 (1). <a href="https://doi.org/10.1515/jci-2016-0010" class="external-link">https://doi.org/10.1515/jci-2016-0010</a>.
</div>
<div id="ref-zhouResidualBalancingMethod2020" class="csl-entry">
Zhou, Xiang, and Geoffrey T. Wodtke. 2020. <span>“Residual Balancing: A
Method of Constructing Weights for Marginal Structural Models.”</span>
<em>Political Analysis</em> 28 (4): 487–506. <a href="https://doi.org/10.1017/pan.2020.2" class="external-link">https://doi.org/10.1017/pan.2020.2</a>.
</div>
<div id="ref-zubizarretaStableWeightsThat2015" class="csl-entry">
Zubizarreta, José R. 2015. <span>“Stable Weights That Balance Covariates
for Estimation with Incomplete Outcome Data.”</span> <em>Journal of the
American Statistical Association</em> 110 (511): 910–22. <a href="https://doi.org/10.1080/01621459.2015.1023805" class="external-link">https://doi.org/10.1080/01621459.2015.1023805</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Noah Greifer.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
